

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>waflib.Tools.c_config &mdash; Waf v1.7.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="top" title="Waf v1.7.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Waf v1.7.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for waflib.Tools.c_config</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># encoding: utf-8</span>
<span class="c"># Thomas Nagy, 2005-2010 (ita)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">C/C++/D configuration helpers</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">shlex</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">waflib</span> <span class="kn">import</span> <span class="n">Build</span><span class="p">,</span> <span class="n">Utils</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">Options</span><span class="p">,</span> <span class="n">Logs</span><span class="p">,</span> <span class="n">Errors</span><span class="p">,</span> <span class="n">ConfigSet</span><span class="p">,</span> <span class="n">Runner</span>
<span class="kn">from</span> <span class="nn">waflib.TaskGen</span> <span class="kn">import</span> <span class="n">after_method</span><span class="p">,</span> <span class="n">feature</span>
<span class="kn">from</span> <span class="nn">waflib.Configure</span> <span class="kn">import</span> <span class="n">conf</span>

<span class="n">WAF_CONFIG_H</span>   <span class="o">=</span> <span class="s">&#39;config.h&#39;</span>
<span class="sd">&quot;&quot;&quot;default name for the config.h file&quot;&quot;&quot;</span>

<span class="n">DEFKEYS</span> <span class="o">=</span> <span class="s">&#39;define_key&#39;</span>
<span class="n">INCKEYS</span> <span class="o">=</span> <span class="s">&#39;include_key&#39;</span>

<span class="n">cfg_ver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&#39;atleast-version&#39;</span><span class="p">:</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span>
	<span class="s">&#39;exact-version&#39;</span><span class="p">:</span> <span class="s">&#39;==&#39;</span><span class="p">,</span>
	<span class="s">&#39;max-version&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">SNIP_FUNCTION</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">	int main() {</span>
<span class="s">	void *p;</span>
<span class="s">	p=(void*)(</span><span class="si">%s</span><span class="s">);</span>
<span class="s">	return 0;</span>
<span class="s">}</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="sd">&quot;&quot;&quot;Code template for checking for functions&quot;&quot;&quot;</span>

<span class="n">SNIP_TYPE</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">int main() {</span>
<span class="s">	if ((</span><span class="si">%(type_name)s</span><span class="s"> *) 0) return 0;</span>
<span class="s">	if (sizeof (</span><span class="si">%(type_name)s</span><span class="s">)) return 0;</span>
<span class="s">}</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="sd">&quot;&quot;&quot;Code template for checking for types&quot;&quot;&quot;</span>

<span class="n">SNIP_EMPTY_PROGRAM</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">int main() {</span>
<span class="s">	return 0;</span>
<span class="s">}</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="n">SNIP_FIELD</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">int main() {</span>
<span class="s">	char *off;</span>
<span class="s">	off = (char*) &amp;((</span><span class="si">%(type_name)s</span><span class="s">*)0)-&gt;</span><span class="si">%(field_name)s</span><span class="s">;</span>
<span class="s">	return (size_t) off &lt; sizeof(</span><span class="si">%(type_name)s</span><span class="s">);</span>
<span class="s">}</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="n">MACRO_TO_DESTOS</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">&#39;__linux__&#39;</span>                                      <span class="p">:</span> <span class="s">&#39;linux&#39;</span><span class="p">,</span>
<span class="s">&#39;__GNU__&#39;</span>                                        <span class="p">:</span> <span class="s">&#39;gnu&#39;</span><span class="p">,</span> <span class="c"># hurd</span>
<span class="s">&#39;__FreeBSD__&#39;</span>                                    <span class="p">:</span> <span class="s">&#39;freebsd&#39;</span><span class="p">,</span>
<span class="s">&#39;__NetBSD__&#39;</span>                                     <span class="p">:</span> <span class="s">&#39;netbsd&#39;</span><span class="p">,</span>
<span class="s">&#39;__OpenBSD__&#39;</span>                                    <span class="p">:</span> <span class="s">&#39;openbsd&#39;</span><span class="p">,</span>
<span class="s">&#39;__sun&#39;</span>                                          <span class="p">:</span> <span class="s">&#39;sunos&#39;</span><span class="p">,</span>
<span class="s">&#39;__hpux&#39;</span>                                         <span class="p">:</span> <span class="s">&#39;hpux&#39;</span><span class="p">,</span>
<span class="s">&#39;__sgi&#39;</span>                                          <span class="p">:</span> <span class="s">&#39;irix&#39;</span><span class="p">,</span>
<span class="s">&#39;_AIX&#39;</span>                                           <span class="p">:</span> <span class="s">&#39;aix&#39;</span><span class="p">,</span>
<span class="s">&#39;__CYGWIN__&#39;</span>                                     <span class="p">:</span> <span class="s">&#39;cygwin&#39;</span><span class="p">,</span>
<span class="s">&#39;__MSYS__&#39;</span>                                       <span class="p">:</span> <span class="s">&#39;msys&#39;</span><span class="p">,</span>
<span class="s">&#39;_UWIN&#39;</span>                                          <span class="p">:</span> <span class="s">&#39;uwin&#39;</span><span class="p">,</span>
<span class="s">&#39;_WIN64&#39;</span>                                         <span class="p">:</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span>
<span class="s">&#39;_WIN32&#39;</span>                                         <span class="p">:</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span>
<span class="c"># Note about darwin: this is also tested with &#39;defined __APPLE__ &amp;&amp; defined __MACH__&#39; somewhere below in this file.</span>
<span class="s">&#39;__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__&#39;</span>  <span class="p">:</span> <span class="s">&#39;darwin&#39;</span><span class="p">,</span> 
<span class="s">&#39;__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__&#39;</span> <span class="p">:</span> <span class="s">&#39;darwin&#39;</span><span class="p">,</span> <span class="c"># iphone</span>
<span class="s">&#39;__QNX__&#39;</span>                                        <span class="p">:</span> <span class="s">&#39;qnx&#39;</span><span class="p">,</span>
<span class="s">&#39;__native_client__&#39;</span>                              <span class="p">:</span> <span class="s">&#39;nacl&#39;</span> <span class="c"># google native client platform</span>
<span class="p">}</span>

<span class="n">MACRO_TO_DEST_CPU</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">&#39;__x86_64__&#39;</span>  <span class="p">:</span> <span class="s">&#39;x86_64&#39;</span><span class="p">,</span>
<span class="s">&#39;__i386__&#39;</span>    <span class="p">:</span> <span class="s">&#39;x86&#39;</span><span class="p">,</span>
<span class="s">&#39;__ia64__&#39;</span>    <span class="p">:</span> <span class="s">&#39;ia&#39;</span><span class="p">,</span>
<span class="s">&#39;__mips__&#39;</span>    <span class="p">:</span> <span class="s">&#39;mips&#39;</span><span class="p">,</span>
<span class="s">&#39;__sparc__&#39;</span>   <span class="p">:</span> <span class="s">&#39;sparc&#39;</span><span class="p">,</span>
<span class="s">&#39;__alpha__&#39;</span>   <span class="p">:</span> <span class="s">&#39;alpha&#39;</span><span class="p">,</span>
<span class="s">&#39;__arm__&#39;</span>     <span class="p">:</span> <span class="s">&#39;arm&#39;</span><span class="p">,</span>
<span class="s">&#39;__hppa__&#39;</span>    <span class="p">:</span> <span class="s">&#39;hppa&#39;</span><span class="p">,</span>
<span class="s">&#39;__powerpc__&#39;</span> <span class="p">:</span> <span class="s">&#39;powerpc&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="nd">@conf</span>
<div class="viewcode-block" id="parse_flags"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.parse_flags">[docs]</a><span class="k">def</span> <span class="nf">parse_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">uselib_store</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force_static</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Parse the flags from the input lines, and add them to the relevant use variables::</span>

<span class="sd">		def configure(conf):</span>
<span class="sd">			conf.parse_flags(&#39;-O3&#39;, &#39;FOO&#39;)</span>
<span class="sd">			# conf.env.CXXFLAGS_FOO = [&#39;-O3&#39;]</span>
<span class="sd">			# conf.env.CFLAGS_FOO = [&#39;-O3&#39;]</span>

<span class="sd">	:param line: flags</span>
<span class="sd">	:type line: string</span>
<span class="sd">	:param uselib_store: where to add the flags</span>
<span class="sd">	:type uselib_store: string</span>
<span class="sd">	:param env: config set or conf.env by default</span>
<span class="sd">	:type env: :py:class:`waflib.ConfigSet.ConfigSet`</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>

	<span class="n">env</span> <span class="o">=</span> <span class="n">env</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>

	<span class="c"># append_unique is not always possible</span>
	<span class="c"># for example, apple flags may require both -arch i386 and -arch ppc</span>

	<span class="n">app</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">append_value</span>
	<span class="n">appu</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">append_unique</span>
	<span class="c">#lst = shlex.split(line)</span>
	<span class="c"># issue #811</span>
	<span class="n">lex</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">shlex</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">posix</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">lex</span><span class="o">.</span><span class="n">whitespace_split</span> <span class="o">=</span> <span class="bp">True</span>
	<span class="n">lex</span><span class="o">.</span><span class="n">commenters</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
	<span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lex</span><span class="p">)</span>

	<span class="n">uselib</span> <span class="o">=</span> <span class="n">uselib_store</span>
	<span class="k">while</span> <span class="n">lst</span><span class="p">:</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">st</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">ot</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

		<span class="k">if</span> <span class="n">st</span> <span class="o">==</span> <span class="s">&#39;-I&#39;</span> <span class="ow">or</span> <span class="n">st</span> <span class="o">==</span> <span class="s">&#39;/I&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">ot</span><span class="p">:</span> <span class="n">ot</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">appu</span><span class="p">(</span><span class="s">&#39;INCLUDES_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">ot</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s">&#39;-include&#39;</span><span class="p">:</span>
			<span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CFLAGS&#39;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CXXFLAGS&#39;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s">&#39;-D&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">CXX_NAME</span> <span class="o">==</span> <span class="s">&#39;msvc&#39;</span> <span class="ow">and</span> <span class="n">st</span> <span class="o">==</span> <span class="s">&#39;/D&#39;</span><span class="p">):</span> <span class="c"># not perfect but..</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">ot</span><span class="p">:</span> <span class="n">ot</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;DEFINES_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">ot</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s">&#39;-l&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">ot</span><span class="p">:</span> <span class="n">ot</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">prefix</span> <span class="o">=</span> <span class="n">force_static</span> <span class="ow">and</span> <span class="s">&#39;STLIB_&#39;</span> <span class="ow">or</span> <span class="s">&#39;LIB_&#39;</span>
			<span class="n">appu</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">ot</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s">&#39;-L&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">ot</span><span class="p">:</span> <span class="n">ot</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">appu</span><span class="p">(</span><span class="s">&#39;LIBPATH_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">ot</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&#39;-pthread&#39;</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-std&#39;</span><span class="p">):</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CXXFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;LINKFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&#39;-framework&#39;</span><span class="p">:</span>
			<span class="n">appu</span><span class="p">(</span><span class="s">&#39;FRAMEWORK_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)])</span>
		<span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-F&#39;</span><span class="p">):</span>
			<span class="n">appu</span><span class="p">(</span><span class="s">&#39;FRAMEWORKPATH_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]])</span>
		<span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-Wl&#39;</span><span class="p">):</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;LINKFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-m&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-dynamic&#39;</span><span class="p">):</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CXXFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-bundle&#39;</span><span class="p">):</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;LINKFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-undefined&#39;</span><span class="p">):</span>
			<span class="n">arg</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;LINKFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">arg</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-arch&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-isysroot&#39;</span><span class="p">):</span>
			<span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;CXXFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
			<span class="n">app</span><span class="p">(</span><span class="s">&#39;LINKFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.a&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.so&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.dylib&#39;</span><span class="p">):</span>
			<span class="n">appu</span><span class="p">(</span><span class="s">&#39;LINKFLAGS_&#39;</span> <span class="o">+</span> <span class="n">uselib</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="c"># not cool, #762</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="ret_msg"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.ret_msg">[docs]</a><span class="k">def</span> <span class="nf">ret_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">f</span>
	<span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="validate_cfg"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.validate_cfg">[docs]</a><span class="k">def</span> <span class="nf">validate_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Search for the program *pkg-config* if missing, and validate the parameters to pass to</span>
<span class="sd">	:py:func:`waflib.Tools.c_config.exec_cfg`.</span>

<span class="sd">	:param path: the **-config program to use** (default is *pkg-config*)</span>
<span class="sd">	:type path: list of string</span>
<span class="sd">	:param msg: message to display to describe the test executed</span>
<span class="sd">	:type msg: string</span>
<span class="sd">	:param okmsg: message to display when the test is successful</span>
<span class="sd">	:type okmsg: string</span>
<span class="sd">	:param errmsg: message to display in case of error</span>
<span class="sd">	:type errmsg: string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">PKGCONFIG</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">find_program</span><span class="p">(</span><span class="s">&#39;pkg-config&#39;</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;PKGCONFIG&#39;</span><span class="p">)</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">PKGCONFIG</span>

	<span class="c"># pkg-config version</span>
	<span class="k">if</span> <span class="s">&#39;atleast_pkgconfig_version&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for pkg-config version &gt;= </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;atleast_pkgconfig_version&#39;</span><span class="p">]</span>
		<span class="k">return</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;okmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;yes&#39;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;errmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;errmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;not found&#39;</span>

	<span class="k">if</span> <span class="s">&#39;modversion&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for </span><span class="si">%r</span><span class="s"> version&#39;</span> <span class="o">%</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;modversion&#39;</span><span class="p">]</span>
		<span class="k">return</span>

	<span class="c"># checking for the version of a module, for the moment, one thing at a time</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cfg_ver</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;package&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> requires a package&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for </span><span class="si">%r</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">],</span> <span class="n">cfg_ver</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
			<span class="k">return</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">])</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="exec_cfg"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.exec_cfg">[docs]</a><span class="k">def</span> <span class="nf">exec_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Execute the program *pkg-config*:</span>

<span class="sd">	* if atleast_pkgconfig_version is given, check that pkg-config has the version n and return</span>
<span class="sd">	* if modversion is given, then return the module version</span>
<span class="sd">	* else, execute the *-config* program with the *args* and *variables* given, and set the flags on the *conf.env.FLAGS_name* variable</span>

<span class="sd">	:param atleast_pkgconfig_version: minimum pkg-config version to use (disable other tests)</span>
<span class="sd">	:type atleast_pkgconfig_version: string</span>
<span class="sd">	:param package: package name, for example *gtk+-2.0*</span>
<span class="sd">	:type package: string</span>
<span class="sd">	:param uselib_store: if the test is successful, define HAVE\_*name*. It is also used to define *conf.env.FLAGS_name* variables.</span>
<span class="sd">	:type uselib_store: string</span>
<span class="sd">	:param modversion: if provided, return the version of the given module and define *name*\_VERSION</span>
<span class="sd">	:type modversion: string</span>
<span class="sd">	:param args: arguments to give to *package* when retrieving flags</span>
<span class="sd">	:type args: list of string</span>
<span class="sd">	:param variables: return the values of particular variables</span>
<span class="sd">	:type variables: list of string</span>
<span class="sd">	:param define_variable: additional variables to define (also in conf.env.PKG_CONFIG_DEFINES)</span>
<span class="sd">	:type define_variable: dict(string: string)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c"># pkg-config version</span>
	<span class="k">if</span> <span class="s">&#39;atleast_pkgconfig_version&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">],</span> <span class="s">&#39;--atleast-pkgconfig-version=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;atleast_pkgconfig_version&#39;</span><span class="p">]]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;okmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;yes&#39;</span>
		<span class="k">return</span>

	<span class="c"># checking for the version of a module</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cfg_ver</span><span class="p">:</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">([</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">],</span> <span class="s">&#39;--</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="n">y</span><span class="p">]),</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]])</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;okmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;yes&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_define</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uselib_store&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">])),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span>

	<span class="c"># retrieving the version of a module</span>
	<span class="k">if</span> <span class="s">&#39;modversion&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">([</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">],</span> <span class="s">&#39;--modversion&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;modversion&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_VERSION&#39;</span> <span class="o">%</span> <span class="n">Utils</span><span class="o">.</span><span class="n">quote_define_name</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uselib_store&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;modversion&#39;</span><span class="p">])),</span> <span class="n">version</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">version</span>

	<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]]</span>

	<span class="n">defi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;define_variable&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">defi</span><span class="p">:</span>
		<span class="n">defi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">PKG_CONFIG_DEFINES</span> <span class="ow">or</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">defi</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--define-variable=</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

	<span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]:</span>
		<span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]))</span>

	<span class="c"># retrieving variables of a module</span>
	<span class="k">if</span> <span class="s">&#39;variables&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">env</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;env&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
		<span class="n">uselib</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uselib_store&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
		<span class="nb">vars</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;variables&#39;</span><span class="p">])</span>
		<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
			<span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">(</span><span class="n">lst</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;--variable=&#39;</span> <span class="o">+</span> <span class="n">v</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="n">var</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uselib</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
			<span class="n">env</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;okmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;yes&#39;</span>
		<span class="k">return</span>

	<span class="n">static</span> <span class="o">=</span> <span class="bp">False</span>
	<span class="k">if</span> <span class="s">&#39;args&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">args</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="s">&#39;--static&#39;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">or</span> <span class="s">&#39;--static-libs&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">static</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="n">lst</span> <span class="o">+=</span> <span class="n">args</span>
	<span class="c"># so we assume the command-line will output flags to be parsed afterwards</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;okmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;yes&#39;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_define</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uselib_store&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">])),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">parse_flags</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uselib_store&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;env&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">),</span> <span class="n">force_static</span><span class="o">=</span><span class="n">static</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">ret</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="check_cfg"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.check_cfg">[docs]</a><span class="k">def</span> <span class="nf">check_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Check for configuration flags using a **-config**-like program (pkg-config, sdl-config, etc).</span>
<span class="sd">	Encapsulate the calls to :py:func:`waflib.Tools.c_config.validate_cfg` and :py:func:`waflib.Tools.c_config.exec_cfg`</span>

<span class="sd">	A few examples::</span>

<span class="sd">		def configure(conf):</span>
<span class="sd">			conf.load(&#39;compiler_c&#39;)</span>
<span class="sd">			conf.check_cfg(package=&#39;glib-2.0&#39;, args=&#39;--libs --cflags&#39;)</span>
<span class="sd">			conf.check_cfg(package=&#39;glib-2.0&#39;, uselib_store=&#39;GLIB&#39;, atleast_version=&#39;2.10.0&#39;,</span>
<span class="sd">				args=&#39;--cflags --libs&#39;)</span>
<span class="sd">			conf.check_cfg(package=&#39;pango&#39;)</span>
<span class="sd">			conf.check_cfg(package=&#39;pango&#39;, uselib_store=&#39;MYPANGO&#39;, args=[&#39;--cflags&#39;, &#39;--libs&#39;])</span>
<span class="sd">			conf.check_cfg(package=&#39;pango&#39;,</span>
<span class="sd">				args=[&#39;pango &gt;= 0.1.0&#39;, &#39;pango &lt; 9.9.9&#39;, &#39;--cflags&#39;, &#39;--libs&#39;],</span>
<span class="sd">				msg=&quot;Checking for &#39;pango 0.1.0&#39;&quot;)</span>
<span class="sd">			conf.check_cfg(path=&#39;sdl-config&#39;, args=&#39;--cflags --libs&#39;, package=&#39;&#39;, uselib_store=&#39;SDL&#39;)</span>
<span class="sd">			conf.check_cfg(path=&#39;mpicc&#39;, args=&#39;--showme:compile --showme:link&#39;,</span>
<span class="sd">				package=&#39;&#39;, uselib_store=&#39;OPEN_MPI&#39;, mandatory=False)</span>

<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">k</span><span class="p">:</span>
		<span class="n">lst</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">validate_cfg</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
	<span class="k">if</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_msg</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">])</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_cfg</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
	<span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">:</span>
		<span class="k">if</span> <span class="s">&#39;errmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">end_msg</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;errmsg&#39;</span><span class="p">],</span> <span class="s">&#39;YELLOW&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">Logs</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;The configuration failed&#39;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span>
		<span class="k">if</span> <span class="s">&#39;okmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">end_msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ret_msg</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">))</span>

	<span class="k">return</span> <span class="n">ret</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="validate_c"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.validate_c">[docs]</a><span class="k">def</span> <span class="nf">validate_c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	pre-check the parameters that will be given to run_c_code</span>

<span class="sd">	:param compiler: c or cxx (tries to guess what is best)</span>
<span class="sd">	:type compiler: string</span>
<span class="sd">	:param type: cprogram, cshlib, cstlib - not required if *features are given directly*</span>
<span class="sd">	:type type: binary to create</span>
<span class="sd">	:param feature: desired features for the task generator that will execute the test, for example ``cxx cxxstlib``</span>
<span class="sd">	:type feature: list of string</span>
<span class="sd">	:param fragment: provide a piece of code for the test (default is to let the system create one)</span>
<span class="sd">	:type fragment: string</span>
<span class="sd">	:param uselib_store: define variables after the test is executed (IMPORTANT!)</span>
<span class="sd">	:type uselib_store: string</span>
<span class="sd">	:param use: parameters to use for building (just like the normal *use* keyword)</span>
<span class="sd">	:type use: list of string</span>
<span class="sd">	:param define_name: define to set when the check is over</span>
<span class="sd">	:type define_name: string</span>
<span class="sd">	:param execute: execute the resulting binary</span>
<span class="sd">	:type execute: bool</span>
<span class="sd">	:param define_ret: if execute is set to True, use the execution output in both the define and the return value</span>
<span class="sd">	:type define_ret: bool</span>
<span class="sd">	:param header_name: check for a particular header</span>
<span class="sd">	:type header_name: string</span>
<span class="sd">	:param auto_add_header_name: if header_name was set, add the headers in env.INCKEYS so the next tests will include these headers</span>
<span class="sd">	:type auto_add_header_name: bool</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;env&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">derive</span><span class="p">()</span>
	<span class="n">env</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;env&#39;</span><span class="p">]</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;compiler&#39;</span> <span class="ow">in</span> <span class="n">kw</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;features&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;compiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span>
		<span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;CXX_NAME&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Task</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cxx&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;compiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;cxx&#39;</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CXX&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;a c++ compiler is required&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CC&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;a c compiler is required&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;compile_mode&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span>
		<span class="k">if</span> <span class="s">&#39;cxx&#39;</span> <span class="ow">in</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;features&#39;</span><span class="p">,[]))</span> <span class="ow">or</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;compiler&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;cxx&#39;</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;cxx&#39;</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;cprogram&#39;</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;features&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_mode&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]]</span> <span class="c"># &quot;cprogram c&quot;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;features&#39;</span><span class="p">])</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;compile_filename&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;test.c&#39;</span> <span class="o">+</span> <span class="p">((</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;cxx&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s">&#39;pp&#39;</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span>


	<span class="k">def</span> <span class="nf">to_header</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
		<span class="k">if</span> <span class="s">&#39;header_name&#39;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
			<span class="n">dct</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">])</span>
			<span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;#include &lt;</span><span class="si">%s</span><span class="s">&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">])</span>
		<span class="k">return</span> <span class="s">&#39;&#39;</span>

	<span class="c">#OSX</span>
	<span class="k">if</span> <span class="s">&#39;framework_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">fwkname</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;framework_name&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;uselib_store&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;uselib_store&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fwkname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;no_header&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;header_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">fwk</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">.h&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fwkname</span><span class="p">,</span> <span class="n">fwkname</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;remove_dot_h&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
				<span class="n">fwk</span> <span class="o">=</span> <span class="n">fwk</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="n">fwk</span><span class="p">]</span>

		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for framework </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fwkname</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;framework&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fwkname</span>
		<span class="c">#kw[&#39;frameworkpath&#39;] = set it yourself</span>

	<span class="k">if</span> <span class="s">&#39;function_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">fu</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;function_name&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for function </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fu</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_header</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">+</span> <span class="n">SNIP_FUNCTION</span> <span class="o">%</span> <span class="n">fu</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;uselib_store&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;uselib_store&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fu</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;define_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_define</span><span class="p">(</span><span class="n">fu</span><span class="p">)</span>

	<span class="k">elif</span> <span class="s">&#39;type_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">tu</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;type_name&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;header_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;stdint.h&#39;</span>
		<span class="k">if</span> <span class="s">&#39;field_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">field</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;field_name&#39;</span><span class="p">]</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_header</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">+</span> <span class="n">SNIP_FIELD</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;type_name&#39;</span> <span class="p">:</span> <span class="n">tu</span><span class="p">,</span> <span class="s">&#39;field_name&#39;</span> <span class="p">:</span> <span class="n">field</span><span class="p">}</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for field </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">tu</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;define_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_define</span><span class="p">((</span><span class="n">tu</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_header</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">+</span> <span class="n">SNIP_TYPE</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;type_name&#39;</span> <span class="p">:</span> <span class="n">tu</span><span class="p">}</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for type </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tu</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;define_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_define</span><span class="p">(</span><span class="n">tu</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

	<span class="k">elif</span> <span class="s">&#39;header_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for header </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">]</span>

		<span class="n">l</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">])</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;list of headers in header_name is empty&#39;</span>

		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_header</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">+</span> <span class="n">SNIP_EMPTY_PROGRAM</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;uselib_store&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;uselib_store&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;define_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_define</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

	<span class="k">if</span> <span class="s">&#39;lib&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for library </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;lib&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;uselib_store&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;uselib_store&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;lib&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

	<span class="k">if</span> <span class="s">&#39;stlib&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for static library </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;stlib&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;uselib_store&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;uselib_store&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;stlib&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

	<span class="k">if</span> <span class="s">&#39;fragment&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="c"># an additional code fragment may be provided to replace the predefined code</span>
		<span class="c"># in custom headers</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;fragment&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for code snippet&#39;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;errmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;errmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;no&#39;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">flagsname</span><span class="p">,</span><span class="n">flagstype</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&#39;cxxflags&#39;</span><span class="p">,</span><span class="s">&#39;compiler&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;cflags&#39;</span><span class="p">,</span><span class="s">&#39;compiler&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;linkflags&#39;</span><span class="p">,</span><span class="s">&#39;linker&#39;</span><span class="p">)]:</span>
		<span class="k">if</span> <span class="n">flagsname</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Checking for </span><span class="si">%s</span><span class="s"> flags </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">flagstype</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="n">flagsname</span><span class="p">])</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;errmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="s">&#39;errmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;no&#39;</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;execute&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;execute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
	<span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;execute&#39;</span><span class="p">]:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;features&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;test_exec&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;errmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;errmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;not found&#39;</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;okmsg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;yes&#39;</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;code&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SNIP_EMPTY_PROGRAM</span>

	<span class="c"># if there are headers to append automatically to the next tests</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">INCKEYS</span><span class="p">]:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;#include &lt;</span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">INCKEYS</span><span class="p">]])</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;success&#39;</span><span class="p">):</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

	<span class="k">if</span> <span class="s">&#39;define_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">undefine</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">])</span>

	<span class="k">assert</span> <span class="s">&#39;msg&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">,</span> <span class="s">&#39;invalid parameters, read http://freehackers.org/~tnagy/wafbook/single.html#config_helpers_c&#39;</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="post_check"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.post_check">[docs]</a><span class="k">def</span> <span class="nf">post_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="s">&quot;Set the variables after a test executed in :py:func:`waflib.Tools.c_config.check` was run successfully&quot;</span>

	<span class="n">is_success</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;execute&#39;</span><span class="p">]:</span>
		<span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;define_ret&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
				<span class="n">is_success</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">is_success</span> <span class="o">=</span> <span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">is_success</span> <span class="o">=</span> <span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

	<span class="k">if</span> <span class="s">&#39;define_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="c"># TODO simplify?</span>
		<span class="k">if</span> <span class="s">&#39;header_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span> <span class="ow">or</span> <span class="s">&#39;function_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span> <span class="ow">or</span> <span class="s">&#39;type_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span> <span class="ow">or</span> <span class="s">&#39;fragment&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;execute&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;define_ret&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_success</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">],</span> <span class="n">is_success</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;quote&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">define_cond</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">],</span> <span class="n">is_success</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">define_cond</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;define_name&#39;</span><span class="p">],</span> <span class="n">is_success</span><span class="p">)</span>

	<span class="k">if</span> <span class="s">&#39;header_name&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;auto_add_header_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">INCKEYS</span><span class="p">,</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;header_name&#39;</span><span class="p">]))</span>

	<span class="k">if</span> <span class="n">is_success</span> <span class="ow">and</span> <span class="s">&#39;uselib_store&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
		<span class="kn">from</span> <span class="nn">waflib.Tools</span> <span class="kn">import</span> <span class="n">ccroot</span>

		<span class="c"># TODO see get_uselib_vars from ccroot.py</span>
		<span class="n">_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;features&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ccroot</span><span class="o">.</span><span class="n">USELIB_VARS</span><span class="p">:</span>
				<span class="n">_vars</span> <span class="o">|=</span> <span class="n">ccroot</span><span class="o">.</span><span class="n">USELIB_VARS</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_vars</span><span class="p">:</span>
			<span class="n">lk</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&#39;INCLUDES&#39;</span><span class="p">:</span> <span class="n">lk</span> <span class="o">=</span> <span class="s">&#39;includes&#39;</span>
			<span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&#39;DEFINES&#39;</span><span class="p">:</span> <span class="n">lk</span> <span class="o">=</span> <span class="s">&#39;defines&#39;</span>
			<span class="k">if</span> <span class="n">lk</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">val</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">lk</span><span class="p">]</span>
				<span class="c"># remove trailing slash</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
					<span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_unique</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;uselib_store&#39;</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">is_success</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="check"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.check">[docs]</a><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Perform a configuration test by calling :py:func:`waflib.Tools.c_config.run_c_code`.</span>
<span class="sd">	For the complete list of parameters, see :py:func:`waflib.Tools.c_config.validate_c`.</span>
<span class="sd">	To force a specific compiler, prefer the methods :py:func:`waflib.Tools.c_config.check_cxx` or :py:func:`waflib.Tools.c_config.check_cc`</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">validate_c</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">start_msg</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">])</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_c_code</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
	<span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end_msg</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;errmsg&#39;</span><span class="p">],</span> <span class="s">&#39;YELLOW&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">Logs</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;The configuration failed&#39;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">kw</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_check</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end_msg</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;errmsg&#39;</span><span class="p">],</span> <span class="s">&#39;YELLOW&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;The configuration failed </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ret</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end_msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ret_msg</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;okmsg&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="test_exec"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.test_exec">[docs]</a><span class="k">class</span> <span class="nc">test_exec</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A task for executing a programs after they are built. See :py:func:`waflib.Tools.c_config.test_exec_fun`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">color</span> <span class="o">=</span> <span class="s">&#39;PINK&#39;</span>
	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span> <span class="s">&#39;rpath&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span> <span class="s">&#39;define_ret&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abspath</span><span class="p">()])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">exec_command</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abspath</span><span class="p">()])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">env</span> <span class="ow">or</span> <span class="p">{}</span>
			<span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">))</span>
			<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="s">&#39;DYLD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="s">&#39;PATH&#39;</span><span class="p">):</span>
				<span class="n">env</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">abspath</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pathsep</span> <span class="o">+</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span> <span class="s">&#39;define_ret&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abspath</span><span class="p">()],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">exec_command</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abspath</span><span class="p">()],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
</div>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;test_exec&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;apply_link&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="test_exec_fun"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.test_exec_fun">[docs]</a><span class="k">def</span> <span class="nf">test_exec_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	The feature **test_exec** is used to create a task that will to execute the binary</span>
<span class="sd">	created (link task output) during the build. The exit status will be set</span>
<span class="sd">	on the build context, so only one program may have the feature *test_exec*.</span>
<span class="sd">	This is used by configuration tests::</span>

<span class="sd">		def configure(conf):</span>
<span class="sd">			conf.check(execute=True)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="s">&#39;test_exec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<span class="n">CACHE_RESULTS</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">COMPILE_ERRORS</span> <span class="o">=</span> <span class="mi">2</span>

<span class="nd">@conf</span>
<div class="viewcode-block" id="run_c_code"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.run_c_code">[docs]</a><span class="k">def</span> <span class="nf">run_c_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create a temporary build context to execute a build. A reference to that build</span>
<span class="sd">	context is kept on self.test_bld for debugging purposes, and you should not rely</span>
<span class="sd">	on it too much (read the note on the cache below).</span>
<span class="sd">	The parameters given in the arguments to this function are passed as arguments for</span>
<span class="sd">	a single task generator created in the build. Only three parameters are obligatory:</span>

<span class="sd">	:param features: features to pass to a task generator created in the build</span>
<span class="sd">	:type features: list of string</span>
<span class="sd">	:param compile_filename: file to create for the compilation (default: *test.c*)</span>
<span class="sd">	:type compile_filename: string</span>
<span class="sd">	:param code: code to write in the filename to compile</span>
<span class="sd">	:type code: string</span>

<span class="sd">	Though this function returns *0* by default, the build may set an attribute named *retval* on the</span>
<span class="sd">	build context object to return a particular value. See :py:func:`waflib.Tools.c_config.test_exec_fun` for example.</span>

<span class="sd">	This function also provides a limited cache. To use it, provide the following option::</span>

<span class="sd">		def options(opt):</span>
<span class="sd">			opt.add_option(&#39;--confcache&#39;, dest=&#39;confcache&#39;, default=0,</span>
<span class="sd">				action=&#39;count&#39;, help=&#39;Use a configuration cache&#39;)</span>

<span class="sd">	And execute the configuration with the following command-line::</span>

<span class="sd">		$ waf configure --confcache</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s">&#39;env&#39;</span><span class="p">]</span>
	<span class="n">h</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">h_list</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
	<span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bldnode</span><span class="o">.</span><span class="n">abspath</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="p">(</span><span class="ow">not</span> <span class="n">Utils</span><span class="o">.</span><span class="n">is_win32</span> <span class="ow">and</span> <span class="s">&#39;.&#39;</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;conf_check_&#39;</span> <span class="o">+</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
		<span class="k">pass</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;cannot use the configuration test folder </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dir</span><span class="p">)</span>

	<span class="n">cachemode</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Options</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;confcache&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">cachemode</span> <span class="o">==</span> <span class="n">CACHE_RESULTS</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">proj</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">ConfigSet</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">&#39;cache_run_c_code&#39;</span><span class="p">))</span>
		<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[</span><span class="s">&#39;cache_run_c_code&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ret</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Test does not build&#39;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ret</span>

	<span class="n">bdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">&#39;testbuild&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bdir</span><span class="p">):</span>
		<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">bdir</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">test_bld</span> <span class="o">=</span> <span class="n">bld</span> <span class="o">=</span> <span class="n">Build</span><span class="o">.</span><span class="n">BuildContext</span><span class="p">(</span><span class="n">top_dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="n">bdir</span><span class="p">)</span>
	<span class="n">bld</span><span class="o">.</span><span class="n">init_dirs</span><span class="p">()</span>
	<span class="n">bld</span><span class="o">.</span><span class="n">progress_bar</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">bld</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>

	<span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_filename&#39;</span><span class="p">]:</span>
		<span class="n">node</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">srcnode</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_filename&#39;</span><span class="p">])</span>
		<span class="n">node</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">])</span>

	<span class="n">bld</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
	<span class="n">bld</span><span class="o">.</span><span class="n">all_envs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_envs</span><span class="p">)</span> <span class="c"># not really necessary</span>
	<span class="n">bld</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;env&#39;</span><span class="p">]</span>

	<span class="n">o</span> <span class="o">=</span> <span class="n">bld</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;features&#39;</span><span class="p">],</span> <span class="n">source</span><span class="o">=</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;compile_filename&#39;</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="s">&#39;testprog&#39;</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">to_log</span><span class="p">(</span><span class="s">&quot;==&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&lt;==&quot;</span> <span class="o">%</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">])</span>

	<span class="c"># compile the program</span>
	<span class="n">bld</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">bld</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
		<span class="k">except</span> <span class="n">Errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">:</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="s">&#39;Test does not build: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">Utils</span><span class="o">.</span><span class="n">ex_stack</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bld</span><span class="p">,</span> <span class="s">&#39;retval&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="c"># cache the results each time</span>
		<span class="n">proj</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">ConfigSet</span><span class="p">()</span>
		<span class="n">proj</span><span class="p">[</span><span class="s">&#39;cache_run_c_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span>
		<span class="n">proj</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">&#39;cache_run_c_code&#39;</span><span class="p">))</span>

	<span class="k">return</span> <span class="n">ret</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="check_cxx"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.check_cxx">[docs]</a><span class="k">def</span> <span class="nf">check_cxx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Same as :py:func:`waflib.Tools.c_config.check` but default to the *c++* programming language</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">kw</span><span class="p">[</span><span class="s">&#39;compiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;cxx&#39;</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="check_cc"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.check_cc">[docs]</a><span class="k">def</span> <span class="nf">check_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Same as :py:func:`waflib.Tools.c_config.check` but default to the *c* programming language</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">kw</span><span class="p">[</span><span class="s">&#39;compiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="define"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.define">[docs]</a><span class="k">def</span> <span class="nf">define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Store a single define and its state into conf.env.DEFINES. If the value is True, False or None it is cast to 1 or 0.</span>

<span class="sd">	:param key: define name</span>
<span class="sd">	:type key: string</span>
<span class="sd">	:param val: value</span>
<span class="sd">	:type val: int or string</span>
<span class="sd">	:param quote: enclose strings in quotes (yes by default)</span>
<span class="sd">	:type quote: bool</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">assert</span> <span class="n">key</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">elif</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>

	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">quote</span> <span class="ow">and</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="ow">or</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span>
	<span class="n">app</span> <span class="o">=</span> <span class="n">s</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

	<span class="n">ban</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span>
	<span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;DEFINES&#39;</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ban</span><span class="p">):</span>
			<span class="n">lst</span><span class="p">[</span><span class="n">lst</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="n">app</span>
			<span class="k">break</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;DEFINES&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_unique</span><span class="p">(</span><span class="n">DEFKEYS</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="undefine"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.undefine">[docs]</a><span class="k">def</span> <span class="nf">undefine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Remove a define from conf.env.DEFINES</span>

<span class="sd">	:param key: define name</span>
<span class="sd">	:type key: string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">assert</span> <span class="n">key</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

	<span class="n">ban</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span>
	<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;DEFINES&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ban</span><span class="p">)]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;DEFINES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lst</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_unique</span><span class="p">(</span><span class="n">DEFKEYS</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="define_cond"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.define_cond">[docs]</a><span class="k">def</span> <span class="nf">define_cond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Conditionally define a name::</span>

<span class="sd">		def configure(conf):</span>
<span class="sd">			conf.define_cond(&#39;A&#39;, True)</span>
<span class="sd">			# equivalent to:</span>
<span class="sd">			# if val: conf.define(&#39;A&#39;, 1)</span>
<span class="sd">			# else: conf.undefine(&#39;A&#39;)</span>

<span class="sd">	:param key: define name</span>
<span class="sd">	:type key: string</span>
<span class="sd">	:param val: value</span>
<span class="sd">	:type val: int or string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">assert</span> <span class="n">key</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">val</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">undefine</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="is_defined"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.is_defined">[docs]</a><span class="k">def</span> <span class="nf">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param key: define name</span>
<span class="sd">	:type key: string</span>
<span class="sd">	:return: True if the define is set</span>
<span class="sd">	:rtype: bool</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">assert</span> <span class="n">key</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

	<span class="n">ban</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;DEFINES&#39;</span><span class="p">]:</span>
		<span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ban</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">True</span>
	<span class="k">return</span> <span class="bp">False</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="get_define"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.get_define">[docs]</a><span class="k">def</span> <span class="nf">get_define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param key: define name</span>
<span class="sd">	:type key: string</span>
<span class="sd">	:return: the value of a previously stored define or None if it is not set</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">assert</span> <span class="n">key</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

	<span class="n">ban</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;DEFINES&#39;</span><span class="p">]:</span>
		<span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ban</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ban</span><span class="p">):]</span>
	<span class="k">return</span> <span class="bp">None</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="have_define"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.have_define">[docs]</a><span class="k">def</span> <span class="nf">have_define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param key: define name</span>
<span class="sd">	:type key: string</span>
<span class="sd">	:return: the input key prefixed by *HAVE_* and substitute any invalid characters.</span>
<span class="sd">	:rtype: string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">HAVE_PAT</span> <span class="ow">or</span> <span class="s">&#39;HAVE_</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">Utils</span><span class="o">.</span><span class="n">quote_define_name</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="write_config_header"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.write_config_header">[docs]</a><span class="k">def</span> <span class="nf">write_config_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configfile</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">guard</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">defines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">define_prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Write a configuration header containing defines and includes::</span>

<span class="sd">		def configure(cnf):</span>
<span class="sd">			cnf.define(&#39;A&#39;, 1)</span>
<span class="sd">			cnf.write_config_header(&#39;config.h&#39;)</span>

<span class="sd">	:param configfile: relative path to the file to create</span>
<span class="sd">	:type configfile: string</span>
<span class="sd">	:param top: write the configuration header from the build directory (default is from the current path)</span>
<span class="sd">	:type top: bool</span>
<span class="sd">	:param defines: add the defines (yes by default)</span>
<span class="sd">	:type defines: bool</span>
<span class="sd">	:param headers: add #include in the file</span>
<span class="sd">	:type headers: bool</span>
<span class="sd">	:type define_prefix: string</span>
<span class="sd">	:param define_prefix: prefix all the defines in the file with a particular prefix</span>
<span class="sd">	:param remove: remove the defines after they are added (yes by default)</span>
<span class="sd">	:type remove: bool</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c"># TODO waf 1.8: the parameter env is not used</span>
	<span class="k">if</span> <span class="n">env</span><span class="p">:</span>
		<span class="n">Logs</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Cannot pass env to write_config_header&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">configfile</span><span class="p">:</span> <span class="n">configfile</span> <span class="o">=</span> <span class="n">WAF_CONFIG_H</span>
	<span class="n">waf_guard</span> <span class="o">=</span> <span class="n">guard</span> <span class="ow">or</span> <span class="s">&#39;W_</span><span class="si">%s</span><span class="s">_WAF&#39;</span> <span class="o">%</span> <span class="n">Utils</span><span class="o">.</span><span class="n">quote_define_name</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>

	<span class="n">node</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bldnode</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">get_bld</span><span class="p">()</span>
	<span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
	<span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

	<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/* WARNING! All changes made to this file will be lost! */</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
	<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#ifndef </span><span class="si">%s</span><span class="se">\n</span><span class="s">#define </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">waf_guard</span><span class="p">,</span> <span class="n">waf_guard</span><span class="p">))</span>
	<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_config_header</span><span class="p">(</span><span class="n">defines</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">define_prefix</span><span class="o">=</span><span class="n">define_prefix</span><span class="p">))</span>
	<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">#endif /* </span><span class="si">%s</span><span class="s"> */</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">waf_guard</span><span class="p">)</span>

	<span class="n">node</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span>

	<span class="c"># config files are not removed on &quot;waf clean&quot;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_unique</span><span class="p">(</span><span class="n">Build</span><span class="o">.</span><span class="n">CFG_FILES</span><span class="p">,</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">abspath</span><span class="p">()])</span>

	<span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">DEFKEYS</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">undefine</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">DEFKEYS</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="get_config_header"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.get_config_header">[docs]</a><span class="k">def</span> <span class="nf">get_config_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">define_prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create the contents of a ``config.h`` file from the defines and includes</span>
<span class="sd">	set in conf.env.define_key / conf.env.include_key. No include guards are added.</span>

<span class="sd">	:param defines: write the defines values</span>
<span class="sd">	:type defines: bool</span>
<span class="sd">	:param headers: write the headers</span>
<span class="sd">	:type headers: bool</span>
<span class="sd">	:type define_prefix: string</span>
<span class="sd">	:param define_prefix: prefix all the defines with a particular prefix</span>
<span class="sd">	:return: the contents of a ``config.h`` file</span>
<span class="sd">	:rtype: string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">INCKEYS</span><span class="p">]:</span>
			<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#include &lt;</span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">defines</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">DEFKEYS</span><span class="p">]:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
				<span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_define</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
				<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#define </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">define_prefix</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;/* #undef </span><span class="si">%s</span><span class="s"> */&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">define_prefix</span> <span class="o">+</span> <span class="n">x</span><span class="p">))</span>
	<span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="cc_add_flags"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.cc_add_flags">[docs]</a><span class="k">def</span> <span class="nf">cc_add_flags</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read the CFLAGS/CPPFLAGS from os.environ and add to conf.env.CFLAGS</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">add_os_flags</span><span class="p">(</span><span class="s">&#39;CPPFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;CFLAGS&#39;</span><span class="p">)</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">add_os_flags</span><span class="p">(</span><span class="s">&#39;CFLAGS&#39;</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="cxx_add_flags"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.cxx_add_flags">[docs]</a><span class="k">def</span> <span class="nf">cxx_add_flags</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read the CXXFLAGS/CPPFLAGS and add to conf.env.CXXFLAGS</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">add_os_flags</span><span class="p">(</span><span class="s">&#39;CPPFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;CXXFLAGS&#39;</span><span class="p">)</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">add_os_flags</span><span class="p">(</span><span class="s">&#39;CXXFLAGS&#39;</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="link_add_flags"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.link_add_flags">[docs]</a><span class="k">def</span> <span class="nf">link_add_flags</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read the LINKFLAGS/LDFLAGS and add to conf.env.LDFLAGS</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">add_os_flags</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">)</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">add_os_flags</span><span class="p">(</span><span class="s">&#39;LDFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;LINKFLAGS&#39;</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="cc_load_tools"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.cc_load_tools">[docs]</a><span class="k">def</span> <span class="nf">cc_load_tools</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Load the c tool</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">unversioned_sys_platform</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="cxx_load_tools"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.cxx_load_tools">[docs]</a><span class="k">def</span> <span class="nf">cxx_load_tools</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Load the cxx tool</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">unversioned_sys_platform</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;cxx&#39;</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="get_cc_version"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.get_cc_version">[docs]</a><span class="k">def</span> <span class="nf">get_cc_version</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">gcc</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">icc</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Run the preprocessor to determine the compiler version</span>

<span class="sd">	The variables CC_VERSION, DEST_OS, DEST_BINFMT and DEST_CPU will be set in *conf.env*</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="n">cc</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;-dM&#39;</span><span class="p">,</span> <span class="s">&#39;-E&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">]</span>
	<span class="n">env</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">env</span> <span class="ow">or</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">Utils</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">Utils</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">Utils</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
		<span class="n">p</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;Could not determine the compiler version </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cmd</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="s">&#39;iso8859-1&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">gcc</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;__INTEL_COMPILER&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;The intel compiler pretends to be gcc&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;__GNUC__&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;Could not determine the compiler type&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">icc</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;__INTEL_COMPILER&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;Not icc/icpc&#39;</span><span class="p">)</span>

	<span class="n">k</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">if</span> <span class="n">icc</span> <span class="ow">or</span> <span class="n">gcc</span><span class="p">:</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
			<span class="n">lst</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
				<span class="n">key</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">val</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
				<span class="n">k</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

		<span class="k">def</span> <span class="nf">isD</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">k</span>

		<span class="k">def</span> <span class="nf">isT</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">k</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span>

		<span class="c"># Some documentation is available at http://predef.sourceforge.net</span>
		<span class="c"># The names given to DEST_OS must match what Utils.unversioned_sys_platform() returns.</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span><span class="p">:</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MACRO_TO_DESTOS</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">isD</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
				<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span> <span class="o">=</span> <span class="n">MACRO_TO_DESTOS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="k">break</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">isD</span><span class="p">(</span><span class="s">&#39;__APPLE__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isD</span><span class="p">(</span><span class="s">&#39;__MACH__&#39;</span><span class="p">):</span>
				<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span> <span class="o">=</span> <span class="s">&#39;darwin&#39;</span>
			<span class="k">elif</span> <span class="n">isD</span><span class="p">(</span><span class="s">&#39;__unix__&#39;</span><span class="p">):</span> <span class="c"># unix must be tested last as it&#39;s a generic fallback</span>
				<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span> <span class="o">=</span> <span class="s">&#39;generic&#39;</span>

		<span class="k">if</span> <span class="n">isD</span><span class="p">(</span><span class="s">&#39;__ELF__&#39;</span><span class="p">):</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">=</span> <span class="s">&#39;elf&#39;</span>
		<span class="k">elif</span> <span class="n">isD</span><span class="p">(</span><span class="s">&#39;__WINNT__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isD</span><span class="p">(</span><span class="s">&#39;__CYGWIN__&#39;</span><span class="p">):</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">=</span> <span class="s">&#39;pe&#39;</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">LIBDIR</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;PREFIX&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/bin&#39;</span>
		<span class="k">elif</span> <span class="n">isD</span><span class="p">(</span><span class="s">&#39;__APPLE__&#39;</span><span class="p">):</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">=</span> <span class="s">&#39;mac-o&#39;</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span><span class="p">:</span>
			<span class="c"># Infer the binary format from the os name.</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">destos_to_binfmt</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_OS</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MACRO_TO_DEST_CPU</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">isD</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
				<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_CPU</span> <span class="o">=</span> <span class="n">MACRO_TO_DEST_CPU</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="k">break</span>

		<span class="n">Logs</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;ccroot: dest platform: &#39;</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;?&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;DEST_OS&#39;</span><span class="p">,</span> <span class="s">&#39;DEST_BINFMT&#39;</span><span class="p">,</span> <span class="s">&#39;DEST_CPU&#39;</span><span class="p">)]))</span>
		<span class="k">if</span> <span class="n">icc</span><span class="p">:</span>
			<span class="n">ver</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="s">&#39;__INTEL_COMPILER&#39;</span><span class="p">]</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CC_VERSION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ver</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CC_VERSION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s">&#39;__GNUC__&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="s">&#39;__GNUC_MINOR__&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="s">&#39;__GNUC_PATCHLEVEL__&#39;</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">k</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="get_xlc_version"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.get_xlc_version">[docs]</a><span class="k">def</span> <span class="nf">get_xlc_version</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">cc</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Get the compiler version&quot;&quot;&quot;</span>

	<span class="n">cmd</span> <span class="o">=</span> <span class="n">cc</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;-qversion&#39;</span><span class="p">]</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">except</span> <span class="n">Errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;Could not find xlc </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cmd</span><span class="p">)</span>

	<span class="c"># the intention is to catch the 8.0 in &quot;IBM XL C/C++ Enterprise Edition V8.0 for AIX...&quot;</span>
	<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="s">r&quot;IBM XL C/C\+\+.* V(?P&lt;major&gt;\d*)\.(?P&lt;minor&gt;\d*)&quot;</span><span class="p">):</span>
		<span class="n">version_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
		<span class="n">match</span> <span class="o">=</span> <span class="n">version_re</span><span class="p">(</span><span class="n">out</span> <span class="ow">or</span> <span class="n">err</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
			<span class="n">k</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CC_VERSION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s">&#39;major&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="s">&#39;minor&#39;</span><span class="p">])</span>
			<span class="k">break</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;Could not determine the XLC version.&#39;</span><span class="p">)</span>

<span class="c"># ============ the --as-needed flag should added during the configuration, not at runtime =========</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="add_as_needed"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.add_as_needed">[docs]</a><span class="k">def</span> <span class="nf">add_as_needed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Add ``--as-needed`` to the *LINKFLAGS*</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">==</span> <span class="s">&#39;elf&#39;</span> <span class="ow">and</span> <span class="s">&#39;gcc&#39;</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXX_NAME</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CC_NAME</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_unique</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;--as-needed&#39;</span><span class="p">)</span>

<span class="c"># ============ parallel configuration</span>
</div>
<div class="viewcode-block" id="cfgtask"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.cfgtask">[docs]</a><span class="k">class</span> <span class="nc">cfgtask</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">TaskBase</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A task that executes configuration tests</span>
<span class="sd">	make sure that the checks write to conf.env in a thread-safe manner</span>

<span class="sd">	for the moment it only executes conf.check</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&#39;&#39;</span>

	<span class="k">def</span> <span class="nf">runnable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">RUN_ME</span>

	<span class="k">def</span> <span class="nf">uid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">Utils</span><span class="o">.</span><span class="n">SIG_NIL</span>

	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span>
		<span class="n">bld</span> <span class="o">=</span> <span class="n">Build</span><span class="o">.</span><span class="n">BuildContext</span><span class="p">(</span><span class="n">top_dir</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">srcnode</span><span class="o">.</span><span class="n">abspath</span><span class="p">(),</span> <span class="n">out_dir</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">bldnode</span><span class="o">.</span><span class="n">abspath</span><span class="p">())</span>
		<span class="n">bld</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span>
		<span class="n">bld</span><span class="o">.</span><span class="n">init_dirs</span><span class="p">()</span>
		<span class="n">bld</span><span class="o">.</span><span class="n">in_msg</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># suppress top-level start_msg</span>
		<span class="n">bld</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">bld</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
			<span class="k">return</span> <span class="mi">1</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="multicheck"><a class="viewcode-back" href="../../../tools/c_config.html#waflib.Tools.c_config.multicheck">[docs]</a><span class="k">def</span> <span class="nf">multicheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Use tuples to perform parallel configuration tests</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">start_msg</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;msg&#39;</span><span class="p">,</span> <span class="s">&#39;Executing </span><span class="si">%d</span><span class="s"> configuration tests&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>

	<span class="k">class</span> <span class="nc">par</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
		<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">keep</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cache_global</span> <span class="o">=</span> <span class="n">Options</span><span class="o">.</span><span class="n">cache_global</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nocache</span> <span class="o">=</span> <span class="n">Options</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">nocache</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">returned_tasks</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">task_sigs</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">def</span> <span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
		<span class="k">def</span> <span class="nf">to_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
			<span class="k">return</span>

	<span class="n">bld</span> <span class="o">=</span> <span class="n">par</span><span class="p">()</span>
	<span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">cfgtask</span><span class="p">(</span><span class="n">bld</span><span class="o">=</span><span class="n">bld</span><span class="p">)</span>
		<span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">x</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">dct</span>
		<span class="n">x</span><span class="o">.</span><span class="n">bld</span> <span class="o">=</span> <span class="n">bld</span>
		<span class="n">x</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span>
		<span class="n">x</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">dct</span>

		<span class="c"># bind a logger that will keep the info in memory</span>
		<span class="n">x</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logs</span><span class="o">.</span><span class="n">make_mem_logger</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">it</span><span class="p">():</span>
		<span class="k">yield</span> <span class="n">tasks</span>
		<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">yield</span> <span class="p">[]</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">Runner</span><span class="o">.</span><span class="n">Parallel</span><span class="p">(</span><span class="n">bld</span><span class="p">,</span> <span class="n">Options</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">biter</span> <span class="o">=</span> <span class="n">it</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

	<span class="c"># flush the logs in order into the config.log</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
		<span class="n">x</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">memhandler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">hasrun</span> <span class="o">!=</span> <span class="n">Task</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">end_msg</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;errmsg&#39;</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;YELLOW&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fatalmsg&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;One of the tests has failed, see the config.log for more information&#39;</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">end_msg</span><span class="p">(</span><span class="s">&#39;ok&#39;</span><span class="p">)</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/waf-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Waf v1.7.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; <a href="../../../copyright.html">Copyright</a> 2010, Thomas Nagy.
    </div>

  </body>
</html>