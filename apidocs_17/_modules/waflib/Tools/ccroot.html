

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>waflib.Tools.ccroot &mdash; Waf v1.7.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="top" title="Waf v1.7.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Waf v1.7.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for waflib.Tools.ccroot</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># encoding: utf-8</span>
<span class="c"># Thomas Nagy, 2005-2010 (ita)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classes and methods shared by tools providing support for C-like language such</span>
<span class="sd">as C/C++/D/Assembly/Go (this support module is almost never used alone).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">waflib</span> <span class="kn">import</span> <span class="n">TaskGen</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">Utils</span><span class="p">,</span> <span class="n">Logs</span><span class="p">,</span> <span class="n">Build</span><span class="p">,</span> <span class="n">Options</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Errors</span>
<span class="kn">from</span> <span class="nn">waflib.TaskGen</span> <span class="kn">import</span> <span class="n">after_method</span><span class="p">,</span> <span class="n">before_method</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">taskgen_method</span><span class="p">,</span> <span class="n">extension</span>
<span class="kn">from</span> <span class="nn">waflib.Tools</span> <span class="kn">import</span> <span class="n">c_aliases</span><span class="p">,</span> <span class="n">c_preproc</span><span class="p">,</span> <span class="n">c_config</span><span class="p">,</span> <span class="n">c_osx</span><span class="p">,</span> <span class="n">c_tests</span>
<span class="kn">from</span> <span class="nn">waflib.Configure</span> <span class="kn">import</span> <span class="n">conf</span>

<span class="n">SYSTEM_LIB_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/usr/lib64&#39;</span><span class="p">,</span> <span class="s">&#39;/usr/lib&#39;</span><span class="p">,</span> <span class="s">&#39;/usr/local/lib64&#39;</span><span class="p">,</span> <span class="s">&#39;/usr/local/lib&#39;</span><span class="p">]</span>

<span class="n">USELIB_VARS</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Mapping for features to :py:class:`waflib.ConfigSet.ConfigSet` variables. See :py:func:`waflib.Tools.ccroot.propagate_uselib_vars`.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;INCLUDES&#39;</span><span class="p">,</span> <span class="s">&#39;FRAMEWORKPATH&#39;</span><span class="p">,</span> <span class="s">&#39;DEFINES&#39;</span><span class="p">,</span> <span class="s">&#39;CPPFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;CCDEPS&#39;</span><span class="p">,</span> <span class="s">&#39;CFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;ARCH&#39;</span><span class="p">])</span>
<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;cxx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;INCLUDES&#39;</span><span class="p">,</span> <span class="s">&#39;FRAMEWORKPATH&#39;</span><span class="p">,</span> <span class="s">&#39;DEFINES&#39;</span><span class="p">,</span> <span class="s">&#39;CPPFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;CXXDEPS&#39;</span><span class="p">,</span> <span class="s">&#39;CXXFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;ARCH&#39;</span><span class="p">])</span>
<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;INCLUDES&#39;</span><span class="p">,</span> <span class="s">&#39;DFLAGS&#39;</span><span class="p">])</span>

<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;cprogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;cxxprogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;LIB&#39;</span><span class="p">,</span> <span class="s">&#39;STLIB&#39;</span><span class="p">,</span> <span class="s">&#39;LIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;STLIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;RPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKDEPS&#39;</span><span class="p">,</span> <span class="s">&#39;FRAMEWORK&#39;</span><span class="p">,</span> <span class="s">&#39;FRAMEWORKPATH&#39;</span><span class="p">,</span> <span class="s">&#39;ARCH&#39;</span><span class="p">])</span>
<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;cshlib&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;cxxshlib&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;LIB&#39;</span><span class="p">,</span> <span class="s">&#39;STLIB&#39;</span><span class="p">,</span> <span class="s">&#39;LIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;STLIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;RPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKDEPS&#39;</span><span class="p">,</span> <span class="s">&#39;FRAMEWORK&#39;</span><span class="p">,</span> <span class="s">&#39;FRAMEWORKPATH&#39;</span><span class="p">,</span> <span class="s">&#39;ARCH&#39;</span><span class="p">])</span>
<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;cstlib&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;cxxstlib&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;ARFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;LINKDEPS&#39;</span><span class="p">])</span>

<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;dprogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;LIB&#39;</span><span class="p">,</span> <span class="s">&#39;STLIB&#39;</span><span class="p">,</span> <span class="s">&#39;LIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;STLIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;RPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKDEPS&#39;</span><span class="p">])</span>
<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;dshlib&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;LIB&#39;</span><span class="p">,</span> <span class="s">&#39;STLIB&#39;</span><span class="p">,</span> <span class="s">&#39;LIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;STLIBPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;RPATH&#39;</span><span class="p">,</span> <span class="s">&#39;LINKDEPS&#39;</span><span class="p">])</span>
<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;dstlib&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;ARFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;LINKDEPS&#39;</span><span class="p">])</span>

<span class="n">USELIB_VARS</span><span class="p">[</span><span class="s">&#39;asm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;ASFLAGS&#39;</span><span class="p">])</span>

<span class="c"># =================================================================================================</span>

<span class="nd">@taskgen_method</span>
<div class="viewcode-block" id="create_compiled_task"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.create_compiled_task">[docs]</a><span class="k">def</span> <span class="nf">create_compiled_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create the compilation task: c, cxx, asm, etc. The output node is created automatically (object file with a typical **.o** extension).</span>
<span class="sd">	The task is appended to the list *compiled_tasks* which is then used by :py:func:`waflib.Tools.ccroot.apply_link`</span>

<span class="sd">	:param name: name of the task class</span>
<span class="sd">	:type name: string</span>
<span class="sd">	:param node: the file to compile</span>
<span class="sd">	:type node: :py:class:`waflib.Node.Node`</span>
<span class="sd">	:return: The task created</span>
<span class="sd">	:rtype: :py:class:`waflib.Task.Task`</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%d</span><span class="s">.o&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
	<span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">find_or_declare</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">compiled_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">compiled_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">task</span>
</div>
<span class="nd">@taskgen_method</span>
<div class="viewcode-block" id="to_incnodes"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.to_incnodes">[docs]</a><span class="k">def</span> <span class="nf">to_incnodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlst</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Task generator method provided to convert a list of string/nodes into a list of includes folders.</span>

<span class="sd">	The paths are assumed to be relative to the task generator path, except if they begin by **#**</span>
<span class="sd">	in which case they are searched from the top-level directory (``bld.srcnode``).</span>
<span class="sd">	The folders are simply assumed to be existing.</span>

<span class="sd">	The node objects in the list are returned in the output list. The strings are converted</span>
<span class="sd">	into node objects if possible. The node is searched from the source directory, and if a match is found,</span>
<span class="sd">	the equivalent build directory is created and added to the returned list too. When a folder cannot be found, it is ignored.</span>

<span class="sd">	:param inlst: list of folders</span>
<span class="sd">	:type inlst: space-delimited string or a list of string/nodes</span>
<span class="sd">	:rtype: list of :py:class:`waflib.Node.Node`</span>
<span class="sd">	:return: list of include folders as nodes</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">inlst</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seen</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
			<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
				<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;#&#39;</span><span class="p">:</span>
					<span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">bldnode</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
					<span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">srcnode</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">get_bld</span><span class="p">()</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
					<span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_child_of</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">bldnode</span><span class="p">):</span>
					<span class="n">p</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
				<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
				<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">lst</span>
</div>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;cxx&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;asm&#39;</span><span class="p">,</span> <span class="s">&#39;fc&#39;</span><span class="p">,</span> <span class="s">&#39;includes&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;propagate_uselib_vars&#39;</span><span class="p">,</span> <span class="s">&#39;process_source&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="apply_incpaths"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.apply_incpaths">[docs]</a><span class="k">def</span> <span class="nf">apply_incpaths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Task generator method that processes the attribute *includes*::</span>

<span class="sd">		tg = bld(features=&#39;includes&#39;, includes=&#39;.&#39;)</span>

<span class="sd">	The folders only need to be relative to the current directory, the equivalent build directory is</span>
<span class="sd">	added automatically (for headers created in the build directory). This enable using a build directory</span>
<span class="sd">	or not (``top == out``).</span>

<span class="sd">	This method will add a list of nodes read by :py:func:`waflib.Tools.ccroot.to_incnodes` in ``tg.env.INCPATHS``,</span>
<span class="sd">	and the list of include paths in ``tg.env.INCLUDES``.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_incnodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;includes&#39;</span><span class="p">,</span> <span class="p">[]))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;INCLUDES&#39;</span><span class="p">])</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">includes_nodes</span> <span class="o">=</span> <span class="n">lst</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;INCPATHS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">abspath</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="link_task"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.link_task">[docs]</a><span class="k">class</span> <span class="nc">link_task</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Base class for all link tasks. A task generator is supposed to have at most one link task bound in the attribute *link_task*. See :py:func:`waflib.Tools.ccroot.apply_link`.</span>

<span class="sd">	.. inheritance-diagram:: waflib.Tools.ccroot.stlink_task waflib.Tools.c.cprogram waflib.Tools.c.cshlib waflib.Tools.cxx.cxxstlib  waflib.Tools.cxx.cxxprogram waflib.Tools.cxx.cxxshlib waflib.Tools.d.dprogram waflib.Tools.d.dshlib waflib.Tools.d.dstlib waflib.Tools.ccroot.fake_shlib waflib.Tools.ccroot.fake_stlib waflib.Tools.asm.asmprogram waflib.Tools.asm.asmshlib waflib.Tools.asm.asmstlib</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">color</span>   <span class="o">=</span> <span class="s">&#39;YELLOW&#39;</span>

	<span class="n">inst_to</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="sd">&quot;&quot;&quot;Default installation path for the link task outputs, or None to disable&quot;&quot;&quot;</span>

	<span class="n">chmod</span>   <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">O755</span>
	<span class="sd">&quot;&quot;&quot;Default installation mode for the link task outputs&quot;&quot;&quot;</span>

<div class="viewcode-block" id="link_task.add_target"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.link_task.add_target">[docs]</a>	<span class="k">def</span> <span class="nf">add_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Process the *target* attribute to add the platform-specific prefix/suffix such as *.so* or *.exe*.</span>
<span class="sd">		The settings are retrieved from ``env.clsname_PATTERN``</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
			<span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&#39;_PATTERN&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
				<span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span>
			<span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;shlib&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">==</span> <span class="s">&#39;pe&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span> <span class="s">&#39;vnum&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
					<span class="c"># include the version in the dll file name,</span>
					<span class="c"># the import lib file name stays unversionned.</span>
					<span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">vnum</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">pattern</span> <span class="o">%</span> <span class="n">name</span>
			<span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">find_or_declare</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">set_outputs</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="stlink_task"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.stlink_task">[docs]</a><span class="k">class</span> <span class="nc">stlink_task</span><span class="p">(</span><span class="n">link_task</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Base for static link tasks, which use *ar* most of the time.</span>
<span class="sd">	The target is always removed before being written.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">run_str</span> <span class="o">=</span> <span class="s">&#39;${AR} ${ARFLAGS} ${AR_TGT_F}${TGT} ${AR_SRC_F}${SRC}&#39;</span>
</div>
<span class="k">def</span> <span class="nf">rm_tgt</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
	<span class="n">old</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">run</span>
	<span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abspath</span><span class="p">())</span>
		<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span> <span class="k">pass</span>
		<span class="k">return</span> <span class="n">old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;run&#39;</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
<span class="n">rm_tgt</span><span class="p">(</span><span class="n">stlink_task</span><span class="p">)</span>

<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;cxx&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;fc&#39;</span><span class="p">,</span> <span class="s">&#39;asm&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;process_source&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="apply_link"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.apply_link">[docs]</a><span class="k">def</span> <span class="nf">apply_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Collect the tasks stored in ``compiled_tasks`` (created by :py:func:`waflib.Tools.ccroot.create_compiled_task`), and</span>
<span class="sd">	use the outputs for a new instance of :py:class:`waflib.Tools.ccroot.link_task`. The class to use is the first link task</span>
<span class="sd">	matching a name from the attribute *features*, for example::</span>

<span class="sd">			def build(bld):</span>
<span class="sd">				tg = bld(features=&#39;cxx cxxprogram cprogram&#39;, source=&#39;main.c&#39;, target=&#39;app&#39;)</span>

<span class="sd">	will create the task ``tg.link_task`` as a new instance of :py:class:`waflib.Tools.cxx.cxxprogram`</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&#39;cprogram&#39;</span> <span class="ow">and</span> <span class="s">&#39;cxx&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span> <span class="c"># limited compat</span>
			<span class="n">x</span> <span class="o">=</span> <span class="s">&#39;cxxprogram&#39;</span>
		<span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&#39;cshlib&#39;</span> <span class="ow">and</span> <span class="s">&#39;cxx&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
			<span class="n">x</span> <span class="o">=</span> <span class="s">&#39;cxxshlib&#39;</span>

		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Task</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">link_task</span><span class="p">):</span>
				<span class="n">link</span> <span class="o">=</span> <span class="n">x</span>
				<span class="k">break</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span>

	<span class="n">objs</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;compiled_tasks&#39;</span><span class="p">,</span> <span class="p">[])]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">objs</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">add_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

	<span class="c"># remember that the install paths are given by the task generators</span>
	<span class="c"># we need to define install_task even during the build phase because others might need the installation path</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">inst_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_path</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="n">inst_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">inst_to</span>
	<span class="k">if</span> <span class="n">inst_to</span><span class="p">:</span>
		<span class="c"># install a copy of the node list we have at this moment (implib not added)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">install_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">install_files</span><span class="p">(</span><span class="n">inst_to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[:],</span> <span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">chmod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">chmod</span><span class="p">)</span>
</div>
<span class="nd">@taskgen_method</span>
<div class="viewcode-block" id="use_rec"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.use_rec">[docs]</a><span class="k">def</span> <span class="nf">use_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Processes the ``use`` keyword recursively. This method is kind of private and only meant to be used from ``process_use``</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_not</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_seen</span><span class="p">:</span>
		<span class="k">return</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">get_tgen_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
	<span class="k">except</span> <span class="n">Errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">uselib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_not</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="k">return</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
	<span class="n">y</span><span class="o">.</span><span class="n">post</span><span class="p">()</span>

	<span class="c"># bind temporary attributes on the task generator</span>
	<span class="n">y</span><span class="o">.</span><span class="n">tmp_use_objects</span> <span class="o">=</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;objects&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
	<span class="n">y</span><span class="o">.</span><span class="n">tmp_use_stlib</span>   <span class="o">=</span> <span class="n">stlib</span>   <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;stlib&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">link_task</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">link_task</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="n">y</span><span class="o">.</span><span class="n">tmp_use_var</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">objects</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">link_task</span><span class="p">,</span> <span class="n">stlink_task</span><span class="p">):</span>
			<span class="n">stlib</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="n">y</span><span class="o">.</span><span class="n">tmp_use_var</span> <span class="o">=</span> <span class="s">&#39;LIB&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">y</span><span class="o">.</span><span class="n">tmp_use_var</span> <span class="o">=</span> <span class="s">&#39;STLIB&#39;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_prec</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;use&#39;</span><span class="p">,</span> <span class="p">[])):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">use_rec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="n">objects</span><span class="p">,</span> <span class="n">stlib</span><span class="o">=</span><span class="n">stlib</span><span class="p">)</span>
</div>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;cxx&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;use&#39;</span><span class="p">,</span> <span class="s">&#39;fc&#39;</span><span class="p">)</span>
<span class="nd">@before_method</span><span class="p">(</span><span class="s">&#39;apply_incpaths&#39;</span><span class="p">,</span> <span class="s">&#39;propagate_uselib_vars&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;apply_link&#39;</span><span class="p">,</span> <span class="s">&#39;process_source&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="process_use"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.process_use">[docs]</a><span class="k">def</span> <span class="nf">process_use</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Process the ``use`` attribute which contains a list of task generator names::</span>

<span class="sd">		def build(bld):</span>
<span class="sd">			bld.shlib(source=&#39;a.c&#39;, target=&#39;lib1&#39;)</span>
<span class="sd">			bld.program(source=&#39;main.c&#39;, target=&#39;app&#39;, use=&#39;lib1&#39;)</span>

<span class="sd">	See :py:func:`waflib.Tools.ccroot.use_rec`.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">use_not</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_not</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
	<span class="n">use_seen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_seen</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># we would like an ordered set</span>
	<span class="n">use_prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_prec</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">uselib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;uselib&#39;</span><span class="p">,</span> <span class="p">[]))</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">includes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;includes&#39;</span><span class="p">,</span> <span class="p">[]))</span>
	<span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;use&#39;</span><span class="p">,</span> <span class="p">[]))</span>

	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">use_rec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">use_not</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">use_prec</span><span class="p">:</span>
			<span class="k">del</span> <span class="n">use_prec</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

	<span class="c"># topological sort</span>
	<span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_use_seen</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">use_prec</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
				<span class="k">break</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

	<span class="k">while</span> <span class="n">tmp</span><span class="p">:</span>
		<span class="n">e</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
		<span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">nlst</span> <span class="o">=</span> <span class="n">use_prec</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">del</span> <span class="n">use_prec</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nlst</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">use_prec</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">use_prec</span><span class="p">[</span><span class="n">y</span><span class="p">]:</span>
						<span class="k">break</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">use_prec</span><span class="p">:</span>
		<span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">(</span><span class="s">&#39;Cycle detected in the use processing </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">use_prec</span><span class="p">)</span>
	<span class="n">out</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

	<span class="n">link_task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;link_task&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
		<span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">get_tgen_by_name</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">var</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">tmp_use_var</span>
		<span class="k">if</span> <span class="n">var</span> <span class="ow">and</span> <span class="n">link_task</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="s">&#39;LIB&#39;</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">tmp_use_stlib</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">dep_nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
				<span class="n">tmp_path</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">path_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">bldnode</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">var</span> <span class="o">+</span> <span class="s">&#39;PATH&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">tmp_path</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">tmp_use_objects</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">add_objects_from_tgen</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

		<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;export_includes&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_incnodes</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">export_includes</span><span class="p">))</span>

	<span class="c"># and finally, add the uselib variables (no recursion needed)</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">get_tgen_by_name</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;STLIB_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uselib</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">uselib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;uselib&#39;</span><span class="p">,</span> <span class="p">[])):</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;STLIB_&#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uselib</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">uselib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</div>
<span class="nd">@taskgen_method</span>
<div class="viewcode-block" id="accept_node_to_link"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.accept_node_to_link">[docs]</a><span class="k">def</span> <span class="nf">accept_node_to_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	PRIVATE INTERNAL USE ONLY</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pdb&#39;</span><span class="p">)</span>
</div>
<span class="nd">@taskgen_method</span>
<div class="viewcode-block" id="add_objects_from_tgen"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.add_objects_from_tgen">[docs]</a><span class="k">def</span> <span class="nf">add_objects_from_tgen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tg</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Add the objects from the depending compiled tasks as link task inputs.</span>

<span class="sd">	Some objects are filtered: for instance, .pdb files are added</span>
<span class="sd">	to the compiled tasks but not to the link tasks (to avoid errors)</span>
<span class="sd">	PRIVATE INTERNAL USE ONLY</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">link_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">tsk</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tg</span><span class="p">,</span> <span class="s">&#39;compiled_tasks&#39;</span><span class="p">,</span> <span class="p">[]):</span>
			<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tsk</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_node_to_link</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
					<span class="n">link_task</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
<span class="nd">@taskgen_method</span>
<div class="viewcode-block" id="get_uselib_vars"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.get_uselib_vars">[docs]</a><span class="k">def</span> <span class="nf">get_uselib_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:return: the *uselib* variables associated to the *features* attribute (see :py:attr:`waflib.Tools.ccroot.USELIB_VARS`)</span>
<span class="sd">	:rtype: list of string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">USELIB_VARS</span><span class="p">:</span>
			<span class="n">_vars</span> <span class="o">|=</span> <span class="n">USELIB_VARS</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">_vars</span>
</div>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;cxx&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;fc&#39;</span><span class="p">,</span> <span class="s">&#39;javac&#39;</span><span class="p">,</span> <span class="s">&#39;cs&#39;</span><span class="p">,</span> <span class="s">&#39;uselib&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;process_use&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="propagate_uselib_vars"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.propagate_uselib_vars">[docs]</a><span class="k">def</span> <span class="nf">propagate_uselib_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Process uselib variables for adding flags. For example, the following target::</span>

<span class="sd">		def build(bld):</span>
<span class="sd">			bld.env.AFLAGS_aaa = [&#39;bar&#39;]</span>
<span class="sd">			from waflib.Tools.ccroot import USELIB_VARS</span>
<span class="sd">			USELIB_VARS[&#39;aaa&#39;] = set(&#39;AFLAGS&#39;)</span>

<span class="sd">			tg = bld(features=&#39;aaa&#39;, aflags=&#39;test&#39;)</span>

<span class="sd">	The *aflags* attribute will be processed and this method will set::</span>

<span class="sd">			tg.env.AFLAGS = [&#39;bar&#39;, &#39;test&#39;]</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_uselib_vars</span><span class="p">()</span>
	<span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>

	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_vars</span><span class="p">:</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="n">env</span><span class="o">.</span><span class="n">append_unique</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">[])))</span>

	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">_vars</span><span class="p">:</span>
			<span class="n">compvar</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
			<span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">env</span><span class="p">[</span><span class="n">compvar</span><span class="p">])</span>

	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;uselib&#39;</span><span class="p">,</span> <span class="p">[])):</span>
		<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_vars</span><span class="p">:</span>
			<span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">env</span><span class="p">[</span><span class="n">v</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">])</span>

<span class="c"># ============ the code above must not know anything about import libs ==========</span>
</div>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;cshlib&#39;</span><span class="p">,</span> <span class="s">&#39;cxxshlib&#39;</span><span class="p">,</span> <span class="s">&#39;fcshlib&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;apply_link&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="apply_implib"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.apply_implib">[docs]</a><span class="k">def</span> <span class="nf">apply_implib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Handle dlls and their import libs on Windows-like systems.</span>

<span class="sd">	A ``.dll.a`` file called *import library* is generated.</span>
<span class="sd">	It must be installed as it is required for linking the library.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">==</span> <span class="s">&#39;pe&#39;</span><span class="p">:</span>
		<span class="k">return</span>

	<span class="n">dll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
		<span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">name</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">implib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;implib_PATTERN&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">name</span>
	<span class="n">implib</span> <span class="o">=</span> <span class="n">dll</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">find_or_declare</span><span class="p">(</span><span class="n">implib</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;IMPLIB_ST&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">implib</span><span class="o">.</span><span class="n">bldpath</span><span class="p">())</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">implib</span><span class="p">)</span>

	<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;defs&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="o">==</span> <span class="s">&#39;pe&#39;</span><span class="p">:</span>
		<span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">find_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defs</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">(</span><span class="s">&#39;invalid def file </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">defs</span><span class="p">)</span>
		<span class="k">if</span> <span class="s">&#39;msvc&#39;</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CC_NAME</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXX_NAME</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="s">&#39;/def:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">node</span><span class="o">.</span><span class="n">path_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">bldnode</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">dep_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c">#gcc for windows takes *.def file a an input without any special flag</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">inst_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_path</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="n">inst_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">inst_to</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">inst_to</span><span class="p">:</span>
		<span class="k">return</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">implib_install_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">install_as</span><span class="p">(</span><span class="s">&#39;${PREFIX}/lib/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">implib</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">implib</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>

<span class="c"># ============ the code above must not know anything about vnum processing on unix platforms =========</span>
</div>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;cshlib&#39;</span><span class="p">,</span> <span class="s">&#39;cxxshlib&#39;</span><span class="p">,</span> <span class="s">&#39;dshlib&#39;</span><span class="p">,</span> <span class="s">&#39;fcshlib&#39;</span><span class="p">,</span> <span class="s">&#39;vnum&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;apply_link&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="apply_vnum"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.apply_vnum">[docs]</a><span class="k">def</span> <span class="nf">apply_vnum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Enforce version numbering on shared libraries. The valid version numbers must have at most two dots::</span>

<span class="sd">		def build(bld):</span>
<span class="sd">			bld.shlib(source=&#39;a.c&#39;, target=&#39;foo&#39;, vnum=&#39;14.15.16&#39;)</span>

<span class="sd">	In this example, ``libfoo.so`` is installed as ``libfoo.so.1.2.3``, and the following symbolic links are created:</span>

<span class="sd">	* ``libfoo.so   → libfoo.so.1.2.3``</span>
<span class="sd">	* ``libfoo.so.1 → libfoo.so.1.2.3``</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;vnum&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&#39;posix&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">DEST_BINFMT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;elf&#39;</span><span class="p">,</span> <span class="s">&#39;mac-o&#39;</span><span class="p">):</span>
		<span class="k">return</span>

	<span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span>
	<span class="n">nums</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnum</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
	<span class="n">node</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="n">libname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
	<span class="k">if</span> <span class="n">libname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.dylib&#39;</span><span class="p">):</span>
		<span class="n">name3</span> <span class="o">=</span> <span class="n">libname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.dylib&#39;</span><span class="p">,</span> <span class="s">&#39;.</span><span class="si">%s</span><span class="s">.dylib&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnum</span><span class="p">)</span>
		<span class="n">name2</span> <span class="o">=</span> <span class="n">libname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.dylib&#39;</span><span class="p">,</span> <span class="s">&#39;.</span><span class="si">%s</span><span class="s">.dylib&#39;</span> <span class="o">%</span> <span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">name3</span> <span class="o">=</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnum</span>
		<span class="n">name2</span> <span class="o">=</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="c"># add the so name for the ld linker - to disable, just unset env.SONAME_ST</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">SONAME_ST</span><span class="p">:</span>
		<span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">SONAME_ST</span> <span class="o">%</span> <span class="n">name2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

	<span class="c"># the following task is just to enable execution from the build dir :-/</span>
	<span class="n">tsk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="s">&#39;vnum&#39;</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">find_or_declare</span><span class="p">(</span><span class="n">name2</span><span class="p">),</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">find_or_declare</span><span class="p">(</span><span class="n">name3</span><span class="p">)])</span>

	<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="p">,</span> <span class="s">&#39;is_install&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">install_task</span><span class="o">.</span><span class="n">hasrun</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">SKIP_ME</span>
		<span class="n">bld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span>
		<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_task</span><span class="o">.</span><span class="n">dest</span>
		<span class="n">t1</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">install_as</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">name3</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">chmod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">chmod</span><span class="p">)</span>
		<span class="n">t2</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">symlink_as</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name3</span><span class="p">)</span>
		<span class="n">t3</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">symlink_as</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">libname</span><span class="p">,</span> <span class="n">name3</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vnum_install_task</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">)</span>

	<span class="k">if</span> <span class="s">&#39;-dynamiclib&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;install_task&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">install_task</span><span class="o">.</span><span class="n">get_install_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;-install_name&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="vnum"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.vnum">[docs]</a><span class="k">class</span> <span class="nc">vnum</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create the symbolic links for a versioned shared library. Instances are created by :py:func:`waflib.Tools.ccroot.apply_vnum`</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">color</span> <span class="o">=</span> <span class="s">&#39;CYAN&#39;</span>
	<span class="n">quient</span> <span class="o">=</span> <span class="bp">True</span>
	<span class="n">ext_in</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.bin&#39;</span><span class="p">]</span>
	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">abspath</span><span class="p">()</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
				<span class="k">pass</span>

			<span class="k">try</span><span class="p">:</span>
				<span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
				<span class="k">return</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="fake_shlib"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.fake_shlib">[docs]</a><span class="k">class</span> <span class="nc">fake_shlib</span><span class="p">(</span><span class="n">link_task</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Task used for reading a system library and adding the dependency on it</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">runnable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_after</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">hasrun</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">ASK_LATER</span>

		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
			<span class="n">x</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">h_file</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">abspath</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">SKIP_ME</span>
</div>
<div class="viewcode-block" id="fake_stlib"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.fake_stlib">[docs]</a><span class="k">class</span> <span class="nc">fake_stlib</span><span class="p">(</span><span class="n">stlink_task</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Task used for reading a system library and adding the dependency on it</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">runnable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_after</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">hasrun</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">ASK_LATER</span>

		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
			<span class="n">x</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">h_file</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">abspath</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">SKIP_ME</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="read_shlib"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.read_shlib">[docs]</a><span class="k">def</span> <span class="nf">read_shlib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="p">[]):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read a system shared library, enabling its use as a local library. Will trigger a rebuild if the file changes::</span>

<span class="sd">		def build(bld):</span>
<span class="sd">			bld.read_shlib(&#39;m&#39;)</span>
<span class="sd">			bld.program(source=&#39;main.c&#39;, use=&#39;m&#39;)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">&#39;fake_lib&#39;</span><span class="p">,</span> <span class="n">lib_paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> <span class="n">lib_type</span><span class="o">=</span><span class="s">&#39;shlib&#39;</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="read_stlib"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.read_stlib">[docs]</a><span class="k">def</span> <span class="nf">read_stlib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="p">[]):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read a system static library, enabling a use as a local library. Will trigger a rebuild if the file changes.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">&#39;fake_lib&#39;</span><span class="p">,</span> <span class="n">lib_paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> <span class="n">lib_type</span><span class="o">=</span><span class="s">&#39;stlib&#39;</span><span class="p">)</span>
</div>
<span class="n">lib_patterns</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&#39;shlib&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.so&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.so&#39;</span><span class="p">,</span> <span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.dll&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.dll&#39;</span><span class="p">],</span>
	<span class="s">&#39;stlib&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.a&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.a&#39;</span><span class="p">,</span> <span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.dll&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.dll&#39;</span><span class="p">,</span> <span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.lib&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.lib&#39;</span><span class="p">],</span>
<span class="p">}</span>

<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;fake_lib&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="process_lib"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.process_lib">[docs]</a><span class="k">def</span> <span class="nf">process_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Find the location of a foreign library. Used by :py:class:`waflib.Tools.ccroot.read_shlib` and :py:class:`waflib.Tools.ccroot.read_stlib`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">node</span> <span class="o">=</span> <span class="bp">None</span>

	<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lib_patterns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_type</span><span class="p">]]</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_paths</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">SYSTEM_LIB_PATHS</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
			<span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
				<span class="k">continue</span>

		<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
			<span class="n">node</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">node</span><span class="p">:</span>
				<span class="n">node</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">h_file</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">abspath</span><span class="p">())</span>
				<span class="k">break</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="k">break</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">(</span><span class="s">&#39;could not find library </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="s">&#39;fake_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib_type</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="n">node</span><span class="p">])</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

</div>
<span class="k">class</span> <span class="nc">fake_o</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">runnable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">SKIP_ME</span>

<span class="nd">@extension</span><span class="p">(</span><span class="s">&#39;.o&#39;</span><span class="p">,</span> <span class="s">&#39;.obj&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_those_o_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
	<span class="n">tsk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="s">&#39;fake_o&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">node</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">compiled_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsk</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">compiled_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tsk</span><span class="p">]</span>

<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;fake_obj&#39;</span><span class="p">)</span>
<span class="nd">@before_method</span><span class="p">(</span><span class="s">&#39;process_source&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="process_objs"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.process_objs">[docs]</a><span class="k">def</span> <span class="nf">process_objs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Puts object files in the task generator outputs</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">add_those_o_files</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="read_object"><a class="viewcode-back" href="../../../tools/ccroot.html#waflib.Tools.ccroot.read_object">[docs]</a><span class="k">def</span> <span class="nf">read_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read an object file, enabling injection in libs/programs. Will trigger a rebuild if the file changes.</span>

<span class="sd">	:param obj: object file path, as string or Node</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
		<span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">find_resource</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s">&#39;fake_obj&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/waf-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Waf v1.7.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; <a href="../../../copyright.html">Copyright</a> 2010, Thomas Nagy.
    </div>

  </body>
</html>