

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>waflib.Utils &mdash; Waf v1.6.8 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.6.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="Waf v1.6.8 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Waf v1.6.8 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for waflib.Utils</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># encoding: utf-8</span>
<span class="c"># Thomas Nagy, 2005-2010 (ita)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Utilities and platform-specific fixes</span>

<span class="sd">The portability fixes try to provide a consistent behavior of the Waf API</span>
<span class="sd">through Python versions 2.3 to 3.X and across different platforms (win32, linux, etc)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">errno</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">gc</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="kn">import</span> <span class="nn">waflib.extras.subprocess</span> <span class="kn">as</span> <span class="nn">subprocess</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&quot;The subprocess module is missing (python2.3?):</span><span class="se">\n</span><span class="s"> try calling &#39;waf update --files=subprocess&#39;</span><span class="se">\n</span><span class="s"> or add a copy of subprocess.py to the python libraries&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	<span class="k">class</span> <span class="nc">deque</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;A deque for Python 2.3 which does not have one&quot;&quot;&quot;</span>
		<span class="k">def</span> <span class="nf">popleft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">_winreg</span> <span class="kn">as</span> <span class="nn">winreg</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="kn">import</span> <span class="nn">winreg</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="n">winreg</span> <span class="o">=</span> <span class="bp">None</span>

<span class="kn">from</span> <span class="nn">waflib</span> <span class="kn">import</span> <span class="n">Errors</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserDict</span>
<span class="k">except</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">UserDict</span> <span class="kn">import</span> <span class="n">UserDict</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="kn">from</span> <span class="nn">md5</span> <span class="kn">import</span> <span class="n">md5</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="c"># never fail to enable fixes from another module</span>
		<span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">threading</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">class</span> <span class="nc">threading</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			A fake threading class for platforms lacking the threading module.</span>
<span class="sd">			Use ``waf -j1`` on those platforms</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span>
	<span class="k">class</span> <span class="nc">Lock</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Fake Lock class&quot;&quot;&quot;</span>
		<span class="k">def</span> <span class="nf">acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">pass</span>
		<span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">pass</span>
	<span class="n">threading</span><span class="o">.</span><span class="n">Lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span> <span class="o">=</span> <span class="n">Lock</span>
<span class="k">else</span><span class="p">:</span>
	<span class="n">run_old</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">run</span>
	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">run_old</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
			<span class="k">raise</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
	<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="n">run</span>

<span class="n">SIG_NIL</span> <span class="o">=</span> <span class="s">&#39;iluvcuteoverload&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;Arbitrary null value for a md5 hash. This value must be changed when the hash value is replaced (size)&quot;&quot;&quot;</span>

<span class="n">O644</span> <span class="o">=</span> <span class="mi">420</span>
<span class="sd">&quot;&quot;&quot;Constant representing the permissions for regular files (0644 raises a syntax error on python 3)&quot;&quot;&quot;</span>

<span class="n">O755</span> <span class="o">=</span> <span class="mi">493</span>
<span class="sd">&quot;&quot;&quot;Constant representing the permissions for executable files (0755 raises a syntax error on python 3)&quot;&quot;&quot;</span>

<span class="n">rot_chr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">]</span>
<span class="s">&quot;List of characters to use when displaying the throbber (progress bar)&quot;</span>

<span class="n">rot_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="s">&quot;Index of the current throbber character (progress bar)&quot;</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	<span class="k">class</span> <span class="nc">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		defaultdict was introduced in python 2.5, so we leave it for python 2.4 and 2.3</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_factory</span><span class="p">):</span>
			<span class="nb">super</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="o">=</span> <span class="n">default_factory</span>
		<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">()</span>
				<span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
				<span class="k">return</span> <span class="n">value</span>

<span class="n">is_win32</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;cli&#39;</span><span class="p">)</span>

<span class="c"># we should have put this in the Logs.py file instead :-/</span>
<span class="n">indicator</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1b</span><span class="s">[K</span><span class="si">%s%s%s</span><span class="se">\r</span><span class="s">&#39;</span>
<span class="k">if</span> <span class="n">is_win32</span> <span class="ow">and</span> <span class="s">&#39;NOCOLOR&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
	<span class="n">indicator</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%s%s</span><span class="se">\r</span><span class="s">&#39;</span>

<div class="viewcode-block" id="readf"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.readf">[docs]</a><span class="k">def</span> <span class="nf">readf</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read an entire file into a string, in practice the wrapper</span>
<span class="sd">	node.read(..) should be used instead of this method::</span>

<span class="sd">		def build(ctx):</span>
<span class="sd">			from waflib import Utils</span>
<span class="sd">			txt = Utils.readf(self.path.find_node(&#39;wscript&#39;).abspath())</span>
<span class="sd">			txt = ctx.path.find_node(&#39;wscript&#39;).read()</span>

<span class="sd">	:type  fname: string</span>
<span class="sd">	:param fname: Path to file</span>
<span class="sd">	:type  m: string</span>
<span class="sd">	:param m: Open mode</span>
<span class="sd">	:rtype: string</span>
<span class="sd">	:return: Content of the file</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">txt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">txt</span>
</div>
<div class="viewcode-block" id="h_file"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.h_file">[docs]</a><span class="k">def</span> <span class="nf">h_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Compute a hash value for a file by using md5. This method may be replaced by</span>
<span class="sd">	a faster version if necessary. The following uses the file size and the timestamp value::</span>

<span class="sd">		import stat</span>
<span class="sd">		from waflib import Utils</span>
<span class="sd">		def h_file(filename):</span>
<span class="sd">			st = os.stat(filename)</span>
<span class="sd">			if stat.S_ISDIR(st[stat.ST_MODE]): raise IOError(&#39;not a file&#39;)</span>
<span class="sd">			m = Utils.md5()</span>
<span class="sd">			m.update(str(st.st_mtime))</span>
<span class="sd">			m.update(str(st.st_size))</span>
<span class="sd">			m.update(filename)</span>
<span class="sd">			return m.digest()</span>
<span class="sd">		Utils.h_file = h_file</span>

<span class="sd">	:type filename: string</span>
<span class="sd">	:param filename: path to the file to hash</span>
<span class="sd">	:return: hash of the file contents</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">md5</span><span class="p">()</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">while</span> <span class="n">filename</span><span class="p">:</span>
			<span class="n">filename</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
			<span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</div>
<span class="k">try</span><span class="p">:</span>
	<span class="n">x</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">binascii</span>
	<span class="k">def</span> <span class="nf">to_hex</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="to_hex"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.to_hex">[docs]</a>	<span class="k">def</span> <span class="nf">to_hex</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)</span>
</div>
<span class="n">to_hex</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">Return the hexadecimal representation of a string</span>

<span class="s">:param s: string to convert</span>
<span class="s">:type s: string</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">listdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span>
<span class="k">if</span> <span class="n">is_win32</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">listdir_win32</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		List the contents of a folder in a portable manner.</span>

<span class="sd">		:type s: string</span>
<span class="sd">		:param s: a string, which can be empty on Windows for listing the drive letters</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="kn">import</span> <span class="nn">ctypes</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="c"># there is nothing much we can do</span>
				<span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s">&#39;:</span><span class="se">\\</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="s">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span><span class="p">)]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">dlen</span> <span class="o">=</span> <span class="mi">4</span> <span class="c"># length of &quot;?:\\x00&quot;</span>
				<span class="n">maxdrives</span> <span class="o">=</span> <span class="mi">26</span>
				<span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">maxdrives</span> <span class="o">*</span> <span class="n">dlen</span><span class="p">)</span>
				<span class="n">ndrives</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">GetLogicalDriveStringsA</span><span class="p">(</span><span class="n">maxdrives</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
				<span class="k">return</span> <span class="p">[</span> <span class="n">buf</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ndrives</span><span class="o">/</span><span class="n">dlen</span><span class="p">))</span> <span class="p">]</span>

		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;:&quot;</span><span class="p">:</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
			<span class="n">e</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>
			<span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">=</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span>
			<span class="k">raise</span> <span class="n">e</span>
		<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
	<span class="n">listdir</span> <span class="o">=</span> <span class="n">listdir_win32</span>

<div class="viewcode-block" id="num2ver"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.num2ver">[docs]</a><span class="k">def</span> <span class="nf">num2ver</span><span class="p">(</span><span class="n">ver</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert a string, tuple or version number into an integer. The number is supposed to have at most 4 digits::</span>

<span class="sd">		from waflib.Utils import num2ver</span>
<span class="sd">		num2ver(&#39;1.3.2&#39;) == num2ver((1,3,2)) == num2ver((1,3,2,0))</span>

<span class="sd">	:type ver: string or tuple of numbers</span>
<span class="sd">	:param ver: a version number</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ver</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
		<span class="n">ver</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ver</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">))</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ver</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ver</span><span class="p">):</span>
				<span class="n">ret</span> <span class="o">+=</span> <span class="mi">256</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">ret</span>
	<span class="k">return</span> <span class="n">ver</span>
</div>
<div class="viewcode-block" id="ex_stack"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.ex_stack">[docs]</a><span class="k">def</span> <span class="nf">ex_stack</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Extract the stack to display exceptions</span>

<span class="sd">	:return: a string represening the last exception</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
	<span class="n">exc_lines</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>
	<span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exc_lines</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="to_list"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.to_list">[docs]</a><span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="n">sth</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert a string argument to a list by splitting on spaces, and pass</span>
<span class="sd">	through a list argument unchanged::</span>

<span class="sd">		from waflib.Utils import to_list</span>
<span class="sd">		lst = to_list(&quot;a b c d&quot;)</span>

<span class="sd">	:param sth: List or a string of items separated by spaces</span>
<span class="sd">	:rtype: list</span>
<span class="sd">	:return: Argument converted to list</span>

<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sth</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">sth</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">sth</span>
</div>
<span class="n">re_nl</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">*</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<div class="viewcode-block" id="str_to_dict"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.str_to_dict">[docs]</a><span class="k">def</span> <span class="nf">str_to_dict</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Parse a string with key = value pairs into a dictionary::</span>

<span class="sd">		from waflib import Utils</span>
<span class="sd">		x = Utils.str_to_dict(&#39;&#39;&#39;</span>
<span class="sd">			a = 1</span>
<span class="sd">			b = test</span>
<span class="sd">		&#39;&#39;&#39;)</span>

<span class="sd">	:type  s: string</span>
<span class="sd">	:param s: String to parse</span>
<span class="sd">	:rtype: dict</span>
<span class="sd">	:return: Dictionary containing parsed key-value pairs</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">tbl</span> <span class="o">=</span> <span class="p">{}</span>

	<span class="n">lines</span> <span class="o">=</span> <span class="n">re_nl</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
		<span class="n">tbl</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="s">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">tbl</span>
</div>
<div class="viewcode-block" id="split_path"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.split_path">[docs]</a><span class="k">def</span> <span class="nf">split_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">split_path_cygwin</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">):</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
		<span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">ret</span>
	<span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>

<span class="n">re_sp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;[/</span><span class="se">\\\\</span><span class="s">]&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">split_path_win32</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">):</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">re_sp</span><span class="p">,</span> <span class="n">path</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
		<span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">ret</span>
	<span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">re_sp</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;cygwin&#39;</span><span class="p">:</span>
	<span class="n">split_path</span> <span class="o">=</span> <span class="n">split_path_cygwin</span>
<span class="k">elif</span> <span class="n">is_win32</span><span class="p">:</span>
	<span class="n">split_path</span> <span class="o">=</span> <span class="n">split_path_win32</span>

<span class="n">split_path</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">Split a path by / or </span><span class="se">\\</span><span class="s">. This function is not like os.path.split</span>

<span class="s">:type  path: string</span>
<span class="s">:param path: path to split</span>
<span class="s">:return:     list of strings</span>
<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="check_dir"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.check_dir">[docs]</a><span class="k">def</span> <span class="nf">check_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Ensure that a directory exists (similar to ``mkdir -p``).</span>

<span class="sd">	:type  dir: string</span>
<span class="sd">	:param dir: Path to directory</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">(</span><span class="s">&#39;Cannot create the folder </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span> <span class="n">ex</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="def_attrs"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.def_attrs">[docs]</a><span class="k">def</span> <span class="nf">def_attrs</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Set default attributes on a class instance</span>

<span class="sd">	:type cls: class</span>
<span class="sd">	:param cls: the class to update the given attributes in.</span>
<span class="sd">	:type kw: dict</span>
<span class="sd">	:param kw: dictionary of attributes names and values.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="quote_define_name"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.quote_define_name">[docs]</a><span class="k">def</span> <span class="nf">quote_define_name</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert a string to an identifier suitable for C defines.</span>

<span class="sd">	:type  s: string</span>
<span class="sd">	:param s: String to convert</span>
<span class="sd">	:rtype: string</span>
<span class="sd">	:return: Identifier suitable for C defines</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">fu</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;[^a-zA-Z0-9]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
	<span class="n">fu</span> <span class="o">=</span> <span class="n">fu</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">fu</span>
</div>
<div class="viewcode-block" id="h_list"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.h_list">[docs]</a><span class="k">def</span> <span class="nf">h_list</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Hash lists. For tuples, using hash(tup) is much more efficient</span>

<span class="sd">	:param lst: list to hash</span>
<span class="sd">	:type lst: list of strings</span>
<span class="sd">	:return: hash of the list</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">md5</span><span class="p">()</span>
	<span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
	<span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="h_fun"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.h_fun">[docs]</a><span class="k">def</span> <span class="nf">h_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Hash functions</span>

<span class="sd">	:param fun: function to hash</span>
<span class="sd">	:type  fun: function</span>
<span class="sd">	:return: hash of the function</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="n">code</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">h</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
			<span class="n">h</span> <span class="o">=</span> <span class="s">&quot;nocode&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">fun</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">h</span>
		<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">return</span> <span class="n">h</span>
</div>
<span class="n">reg_subst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(</span><span class="se">\\\\</span><span class="s">)|(\$\$)|\$\{([^}]+)\}&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="subst_vars"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.subst_vars">[docs]</a><span class="k">def</span> <span class="nf">subst_vars</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Replace ${VAR} with the value of VAR taken from a dict or a config set::</span>

<span class="sd">		from waflib import Utils</span>
<span class="sd">		s = Utils.subst_vars(&#39;${PREFIX}/bin&#39;, env)</span>

<span class="sd">	:type  expr: string</span>
<span class="sd">	:param expr: String to perform substitution on</span>
<span class="sd">	:param params: Dictionary or config set to look up variable values.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">repl_var</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
			<span class="k">return</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
		<span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
			<span class="k">return</span> <span class="s">&#39;$&#39;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="c"># ConfigSet instances may contain lists</span>
			<span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="n">get_flat</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
		<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
	<span class="k">return</span> <span class="n">reg_subst</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl_var</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="destos_to_binfmt"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.destos_to_binfmt">[docs]</a><span class="k">def</span> <span class="nf">destos_to_binfmt</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return the binary format based on the unversioned platform name.</span>

<span class="sd">	:param key: platform name</span>
<span class="sd">	:type  key: string</span>
<span class="sd">	:return: string representing the binary format</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#39;mac-o&#39;</span>
	<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;cygwin&#39;</span><span class="p">,</span> <span class="s">&#39;uwin&#39;</span><span class="p">,</span> <span class="s">&#39;msys&#39;</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&#39;pe&#39;</span>
	<span class="k">return</span> <span class="s">&#39;elf&#39;</span>
</div>
<div class="viewcode-block" id="unversioned_sys_platform"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.unversioned_sys_platform">[docs]</a><span class="k">def</span> <span class="nf">unversioned_sys_platform</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return the unversioned platform name.</span>
<span class="sd">	Some Python platform names contain versions, that depend on</span>
<span class="sd">	the build environment, e.g. linux2, freebsd6, etc.</span>
<span class="sd">	This returns the name without the version number. Exceptions are</span>
<span class="sd">	os2 and win32, which are returned verbatim.</span>

<span class="sd">	:rtype: string</span>
<span class="sd">	:return: Unversioned platform name</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>
	<span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;java&#39;</span><span class="p">:</span>
		<span class="c"># The real OS is hidden under the JVM.</span>
		<span class="kn">from</span> <span class="nn">java.lang</span> <span class="kn">import</span> <span class="n">System</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&#39;os.name&#39;</span><span class="p">)</span>
		<span class="c"># see http://lopica.sourceforge.net/os.html for a list of possible values</span>
		<span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;Mac OS X&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&#39;darwin&#39;</span>
		<span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Windows &#39;</span><span class="p">):</span>
			<span class="k">return</span> <span class="s">&#39;win32&#39;</span>
		<span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;OS/2&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&#39;os2&#39;</span>
		<span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;HP-UX&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="s">&#39;hpux&#39;</span>
		<span class="k">elif</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;SunOS&#39;</span><span class="p">,</span> <span class="s">&#39;Solaris&#39;</span><span class="p">):</span>
			<span class="k">return</span> <span class="s">&#39;sunos&#39;</span>
		<span class="k">else</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;os2&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">!=</span> <span class="s">&#39;sunos2&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
	<span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;\d+$&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="nada"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.nada">[docs]</a><span class="k">def</span> <span class="nf">nada</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A function that does nothing</span>

<span class="sd">	:return: None</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">pass</span>
</div>
<div class="viewcode-block" id="Timer"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.Timer">[docs]</a><span class="k">class</span> <span class="nc">Timer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Simple object for timing the execution of commands.</span>
<span class="sd">	Its string representation is the current time::</span>

<span class="sd">		from waflib.Utils import Timer</span>
<span class="sd">		timer = Timer()</span>
<span class="sd">		a_few_operations()</span>
<span class="sd">		s = str(timer)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
		<span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
		<span class="n">hours</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">seconds</span> <span class="o">//</span> <span class="mi">3600</span>
		<span class="n">minutes</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">seconds</span> <span class="o">-</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60</span>
		<span class="n">seconds</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">seconds</span> <span class="o">-</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">-</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">microseconds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">1000</span>
		<span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="k">if</span> <span class="n">days</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">d&#39;</span> <span class="o">%</span> <span class="n">days</span>
		<span class="k">if</span> <span class="n">days</span> <span class="ow">or</span> <span class="n">hours</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">h&#39;</span> <span class="o">%</span> <span class="n">hours</span>
		<span class="k">if</span> <span class="n">days</span> <span class="ow">or</span> <span class="n">hours</span> <span class="ow">or</span> <span class="n">minutes</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">m&#39;</span> <span class="o">%</span> <span class="n">minutes</span>
		<span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%.3f</span><span class="s">s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">is_win32</span><span class="p">:</span>
	<span class="n">old</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span>
	<span class="k">def</span> <span class="nf">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		shutil.copy2 does not copy the file attributes on windows, so we</span>
<span class="sd">		hack into the shutil module to fix the problem</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">old</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
		<span class="n">shutil</span><span class="o">.</span><span class="n">copystat</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="n">shutil</span><span class="p">,</span> <span class="s">&#39;copy2&#39;</span><span class="p">,</span> <span class="n">copy2</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;java&#39;</span><span class="p">:</span>
	<span class="c"># Jython cannot disable the gc but they can enable it ... wtf?</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">gc</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
		<span class="n">gc</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
	<span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
		<span class="n">gc</span><span class="o">.</span><span class="n">disable</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">enable</span>

<div class="viewcode-block" id="read_la_file"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.read_la_file">[docs]</a><span class="k">def</span> <span class="nf">read_la_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read property files, used by msvc.py</span>

<span class="sd">	:param path: file to read</span>
<span class="sd">	:type path: string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">sp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^([^=]+)=</span><span class="se">\&#39;</span><span class="s">(.*)</span><span class="se">\&#39;</span><span class="s">$&#39;</span><span class="p">)</span>
	<span class="n">dc</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">readf</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">_</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="n">dc</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span>
		<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="k">return</span> <span class="n">dc</span>
</div>
<div class="viewcode-block" id="nogc"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.nogc">[docs]</a><span class="k">def</span> <span class="nf">nogc</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Decorator: let a function disable the garbage collector during its execution.</span>
<span class="sd">	It is used in the build context when storing/loading the build cache file (pickle)</span>

<span class="sd">	:param fun: function to execute</span>
<span class="sd">	:type fun: function</span>
<span class="sd">	:return: the return value of the function executed</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">gc</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="n">gc</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">ret</span>
	<span class="n">f</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">__doc__</span>
	<span class="k">return</span> <span class="n">f</span>
</div>
<div class="viewcode-block" id="run_once"><a class="viewcode-back" href="../../Utils.html#waflib.Utils.run_once">[docs]</a><span class="k">def</span> <span class="nf">run_once</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Decorator: let a function cache its results, use like this::</span>

<span class="sd">		@run_once</span>
<span class="sd">		def foo(k):</span>
<span class="sd">			return 345*2343</span>

<span class="sd">	:param fun: function to execute</span>
<span class="sd">	:type fun: function</span>
<span class="sd">	:return: the return value of the function executed</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
			<span class="n">cache</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span>
			<span class="k">return</span> <span class="n">ret</span>
	<span class="n">wrap</span><span class="o">.</span><span class="n">__cache__</span> <span class="o">=</span> <span class="n">cache</span>
	<span class="k">return</span> <span class="n">wrap</span>
</div>
<span class="k">def</span> <span class="nf">get_registry_app_path</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">winreg</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">QueryValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Software</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">Windows</span><span class="se">\\</span><span class="s">CurrentVersion</span><span class="se">\\</span><span class="s">App Paths</span><span class="se">\\</span><span class="si">%s</span><span class="s">.exe&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">result</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/waf-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Waf v1.6.8 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; <a href="../../copyright.html">Copyright</a> 2010, Thomas Nagy.
    </div>

  </body>
</html>