

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>waflib.Tools.msvc &mdash; Waf v1.6.8 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.6.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="top" title="Waf v1.6.8 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Waf v1.6.8 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for waflib.Tools.msvc</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># encoding: utf-8</span>
<span class="c"># Carlos Rafael Giani, 2006 (dv)</span>
<span class="c"># Tamas Pal, 2007 (folti)</span>
<span class="c"># Nicolas Mercier, 2009</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Microsoft Visual C++/Intel C++ compiler support</span>

<span class="sd">Usage::</span>

<span class="sd">	$ waf configure --msvc_version=&quot;msvc 10.0,msvc 9.0&quot; --msvc_target=&quot;x64&quot;</span>

<span class="sd">or::</span>

<span class="sd">	def configure(conf):</span>
<span class="sd">		conf.env[&#39;MSVC_VERSIONS&#39;] = [&#39;msvc 10.0&#39;, &#39;msvc 9.0&#39;, &#39;msvc 8.0&#39;, &#39;msvc 7.1&#39;, &#39;msvc 7.0&#39;, &#39;msvc 6.0&#39;, &#39;wsdk 7.0&#39;, &#39;intel 11&#39;, &#39;PocketPC 9.0&#39;, &#39;Smartphone 8.0&#39;]</span>
<span class="sd">		conf.env[&#39;MSVC_TARGETS&#39;] = [&#39;x64&#39;]</span>
<span class="sd">		conf.load(&#39;msvc&#39;)</span>

<span class="sd">or::</span>

<span class="sd">	def configure(conf):</span>
<span class="sd">		conf.load(&#39;msvc&#39;, funs=&#39;no_autodetect&#39;)</span>
<span class="sd">		conf.check_lib_msvc(&#39;gdi32&#39;)</span>
<span class="sd">		conf.check_libs_msvc(&#39;kernel32 user32&#39;)</span>
<span class="sd">	def build(bld):</span>
<span class="sd">		tg = bld.program(source=&#39;main.c&#39;, target=&#39;app&#39;, use=&#39;KERNEL32 USER32 GDI32&#39;)</span>

<span class="sd">Platforms and targets will be tested in the order they appear;</span>
<span class="sd">the first good configuration will be used.</span>
<span class="sd">Supported platforms: ia64, x64, x86, x86_amd64, x86_ia64</span>

<span class="sd">Compilers supported:</span>

<span class="sd">* msvc       =&gt; Visual Studio, versions 6.0 (VC 98, VC .NET 2002) to 10.0 (Visual Studio 2010)</span>
<span class="sd">* wsdk       =&gt; Windows SDK, versions 6.0, 6.1, 7.0</span>
<span class="sd">* icl        =&gt; Intel compiler, versions 9,10,11</span>
<span class="sd">* Smartphone =&gt; Compiler/SDK for Smartphone devices (armv4/v4i)</span>
<span class="sd">* PocketPC   =&gt; Compiler/SDK for PocketPC devices (armv4/v4i)</span>

<span class="sd">To use WAF in a VS2008 Make file project (see http://code.google.com/p/waf/issues/detail?id=894)</span>
<span class="sd">You may consider to set the environment variable &quot;VS_UNICODE_OUTPUT&quot; to nothing before calling waf.</span>
<span class="sd">So in your project settings use something like &#39;cmd.exe /C &quot;set VS_UNICODE_OUTPUT=&amp; set PYTHONUNBUFFERED=true &amp; waf build&quot;&#39;.</span>
<span class="sd">cmd.exe  /C  &quot;chcp 1252 &amp; set PYTHONUNBUFFERED=true &amp;&amp; set &amp;&amp; waf  configure&quot;</span>
<span class="sd">Setting PYTHONUNBUFFERED gives the unbuffered output.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">_winreg</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="kn">import</span> <span class="nn">winreg</span> <span class="kn">as</span> <span class="nn">_winreg</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="n">_winreg</span> <span class="o">=</span> <span class="bp">None</span>

<span class="kn">from</span> <span class="nn">waflib</span> <span class="kn">import</span> <span class="n">Utils</span><span class="p">,</span> <span class="n">TaskGen</span><span class="p">,</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">Configure</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">waflib.Logs</span> <span class="kn">import</span> <span class="n">debug</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">warn</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">waflib.TaskGen</span> <span class="kn">import</span> <span class="n">after_method</span><span class="p">,</span> <span class="n">before_method</span><span class="p">,</span> <span class="n">feature</span>

<span class="kn">from</span> <span class="nn">waflib.Configure</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">waflib.Tools</span> <span class="kn">import</span> <span class="n">ccroot</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">cxx</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="n">winres</span>


<span class="n">g_msvc_systemlibs</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">aclui activeds ad1 adptif adsiid advapi32 asycfilt authz bhsupp bits bufferoverflowu cabinet</span>
<span class="s">cap certadm certidl ciuuid clusapi comctl32 comdlg32 comsupp comsuppd comsuppw comsuppwd comsvcs</span>
<span class="s">credui crypt32 cryptnet cryptui d3d8thk daouuid dbgeng dbghelp dciman32 ddao35 ddao35d</span>
<span class="s">ddao35u ddao35ud delayimp dhcpcsvc dhcpsapi dlcapi dnsapi dsprop dsuiext dtchelp</span>
<span class="s">faultrep fcachdll fci fdi framedyd framedyn gdi32 gdiplus glauxglu32 gpedit gpmuuid</span>
<span class="s">gtrts32w gtrtst32hlink htmlhelp httpapi icm32 icmui imagehlp imm32 iphlpapi iprop</span>
<span class="s">kernel32 ksguid ksproxy ksuser libcmt libcmtd libcpmt libcpmtd loadperf lz32 mapi</span>
<span class="s">mapi32 mgmtapi minidump mmc mobsync mpr mprapi mqoa mqrt msacm32 mscms mscoree</span>
<span class="s">msdasc msimg32 msrating mstask msvcmrt msvcurt msvcurtd mswsock msxml2 mtx mtxdm</span>
<span class="s">netapi32 nmapinmsupp npptools ntdsapi ntdsbcli ntmsapi ntquery odbc32 odbcbcp</span>
<span class="s">odbccp32 oldnames ole32 oleacc oleaut32 oledb oledlgolepro32 opends60 opengl32</span>
<span class="s">osptk parser pdh penter pgobootrun pgort powrprof psapi ptrustm ptrustmd ptrustu</span>
<span class="s">ptrustud qosname rasapi32 rasdlg rassapi resutils riched20 rpcndr rpcns4 rpcrt4 rtm</span>
<span class="s">rtutils runtmchk scarddlg scrnsave scrnsavw secur32 sensapi setupapi sfc shell32</span>
<span class="s">shfolder shlwapi sisbkup snmpapi sporder srclient sti strsafe svcguid tapi32 thunk32</span>
<span class="s">traffic unicows url urlmon user32 userenv usp10 uuid uxtheme vcomp vcompd vdmdbg</span>
<span class="s">version vfw32 wbemuuid  webpost wiaguid wininet winmm winscard winspool winstrm</span>
<span class="s">wintrust wldap32 wmiutils wow32 ws2_32 wsnmp32 wsock32 wst wtsapi32 xaswitch xolehlp</span>
<span class="s">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;importlibs provided by MSVC/Platform SDK. Do NOT search them&quot;&quot;&quot;</span>

<span class="n">all_msvc_platforms</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&#39;x64&#39;</span><span class="p">,</span> <span class="s">&#39;amd64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="s">&#39;x86&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;ia64&#39;</span><span class="p">,</span> <span class="s">&#39;ia64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;x86_amd64&#39;</span><span class="p">,</span> <span class="s">&#39;amd64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;x86_ia64&#39;</span><span class="p">,</span> <span class="s">&#39;ia64&#39;</span><span class="p">)</span> <span class="p">]</span>
<span class="sd">&quot;&quot;&quot;List of msvc platforms&quot;&quot;&quot;</span>

<span class="n">all_wince_platforms</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&#39;armv4&#39;</span><span class="p">,</span> <span class="s">&#39;arm&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;armv4i&#39;</span><span class="p">,</span> <span class="s">&#39;arm&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;mipsii&#39;</span><span class="p">,</span> <span class="s">&#39;mips&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;mipsii_fp&#39;</span><span class="p">,</span> <span class="s">&#39;mips&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;mipsiv&#39;</span><span class="p">,</span> <span class="s">&#39;mips&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;mipsiv_fp&#39;</span><span class="p">,</span> <span class="s">&#39;mips&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;sh4&#39;</span><span class="p">,</span> <span class="s">&#39;sh&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="s">&#39;cex86&#39;</span><span class="p">)</span> <span class="p">]</span>
<span class="sd">&quot;&quot;&quot;List of wince platforms&quot;&quot;&quot;</span>

<span class="n">all_icl_platforms</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&#39;intel64&#39;</span><span class="p">,</span> <span class="s">&#39;amd64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;em64t&#39;</span><span class="p">,</span> <span class="s">&#39;amd64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;ia32&#39;</span><span class="p">,</span> <span class="s">&#39;x86&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Itanium&#39;</span><span class="p">,</span> <span class="s">&#39;ia64&#39;</span><span class="p">)]</span>
<span class="sd">&quot;&quot;&quot;List of icl platforms&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
	<span class="n">opt</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;--msvc_version&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;msvc version, eg: &quot;msvc 10.0,msvc 9.0&quot;&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">opt</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;--msvc_targets&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;msvc targets, eg: &quot;x64,arm&quot;&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setup_msvc</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
	<span class="n">platforms</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Options</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;msvc_targets&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">platforms</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]:</span>
		<span class="n">platforms</span><span class="o">=</span><span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MSVC_TARGETS&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">all_msvc_platforms</span><span class="o">+</span><span class="n">all_icl_platforms</span><span class="o">+</span><span class="n">all_wince_platforms</span><span class="p">]</span>
	<span class="n">desired_versions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Options</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;msvc_version&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">desired_versions</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]:</span>
		<span class="n">desired_versions</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MSVC_VERSIONS&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">versiondict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">desired_versions</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">versiondict</span> <span class="p">[</span><span class="n">version</span><span class="p">])</span>
			<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">arch</span><span class="p">,(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">)</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
					<span class="n">compiler</span><span class="p">,</span><span class="n">revision</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
					<span class="k">return</span> <span class="n">compiler</span><span class="p">,</span><span class="n">revision</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">continue</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">continue</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;msvc: Impossible to find a valid architecture for building (in setup_msvc)&#39;</span><span class="p">)</span>

<span class="nd">@conf</span>
<div class="viewcode-block" id="get_msvc_version"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.get_msvc_version">[docs]</a><span class="k">def</span> <span class="nf">get_msvc_version</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">vcvars</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create a bat file to obtain the location of the libraries</span>

<span class="sd">	:param compiler: ?</span>
<span class="sd">	:param version: ?</span>
<span class="sd">	:target: ?</span>
<span class="sd">	:vcvars: ?</span>
<span class="sd">	:return: the location of msvc, the location of include dirs, and the library paths</span>
<span class="sd">	:rtype: tuple of strings</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">debug</span><span class="p">(</span><span class="s">&#39;msvc: get_msvc_version: </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
	<span class="n">batfile</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">bldnode</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span><span class="s">&#39;waf-print-msvc.bat&#39;</span><span class="p">)</span>
	<span class="n">batfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&quot;&quot;@echo off</span>
<span class="s">set INCLUDE=</span>
<span class="s">set LIB=</span>
<span class="s">call &quot;</span><span class="si">%s</span><span class="s">&quot; </span><span class="si">%s</span><span class="s"></span>
<span class="s">echo PATH=</span><span class="si">%%</span><span class="s">PATH</span><span class="si">%%</span><span class="s"></span>
<span class="s">echo INCLUDE=</span><span class="si">%%</span><span class="s">INCLUDE</span><span class="si">%%</span><span class="s"></span>
<span class="s">echo LIB=</span><span class="si">%%</span><span class="s">LIB</span><span class="si">%%</span><span class="s"></span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vcvars</span><span class="p">,</span><span class="n">target</span><span class="p">))</span>
	<span class="n">sout</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">([</span><span class="s">&#39;cmd&#39;</span><span class="p">,</span> <span class="s">&#39;/E:on&#39;</span><span class="p">,</span> <span class="s">&#39;/V:on&#39;</span><span class="p">,</span> <span class="s">&#39;/C&#39;</span><span class="p">,</span> <span class="n">batfile</span><span class="o">.</span><span class="n">abspath</span><span class="p">()])</span>
	<span class="n">lines</span> <span class="o">=</span> <span class="n">sout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Setting environment&#39;</span><span class="p">,</span> <span class="s">&#39;Setting SDK environment&#39;</span><span class="p">,</span> <span class="s">&#39;Intel(R) C++ Compiler&#39;</span><span class="p">,</span> <span class="s">&#39;Intel Parallel Studio&#39;</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="k">break</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">debug</span><span class="p">(</span><span class="s">&#39;msvc: get_msvc_version: </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> -&gt; not found&#39;</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;msvc: Impossible to find a valid architecture for building (in get_msvc_version)&#39;</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
		<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PATH=&#39;</span><span class="p">):</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
			<span class="n">MSVC_PATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;INCLUDE=&#39;</span><span class="p">):</span>
			<span class="n">MSVC_INCDIR</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>
		<span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;LIB=&#39;</span><span class="p">):</span>
			<span class="n">MSVC_LIBDIR</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>

	<span class="c"># Check if the compiler is usable at all.</span>
	<span class="c"># The detection may return 64-bit versions even on 32-bit systems, and these would fail to run.</span>
	<span class="n">env</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
	<span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">PATH</span> <span class="o">=</span> <span class="n">path</span><span class="p">)</span>
	<span class="n">compiler_name</span><span class="p">,</span> <span class="n">linker_name</span><span class="p">,</span> <span class="n">lib_name</span> <span class="o">=</span> <span class="n">_get_prog_names</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">compiler</span><span class="p">)</span>
	<span class="n">cxx</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">find_program</span><span class="p">(</span><span class="n">compiler_name</span><span class="p">,</span> <span class="n">path_list</span><span class="o">=</span><span class="n">MSVC_PATH</span><span class="p">)</span>
	<span class="n">cxx</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">cmd_to_list</span><span class="p">(</span><span class="n">cxx</span><span class="p">)</span>

	<span class="c"># delete CL if exists. because it could contain parameters wich can change cl&#39;s behaviour rather catastrophically.</span>
	<span class="k">if</span> <span class="s">&#39;CL&#39;</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
		<span class="k">del</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CL&#39;</span><span class="p">])</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">(</span><span class="n">cxx</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;/help&#39;</span><span class="p">],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="n">debug</span><span class="p">(</span><span class="s">&#39;msvc: get_msvc_version: </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> -&gt; failure&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
			<span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;msvc: cannot run the compiler (in get_msvc_version)&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">debug</span><span class="p">(</span><span class="s">&#39;msvc: get_msvc_version: </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> -&gt; OK&#39;</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">compiler_name</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">MSVC_PATH</span><span class="p">,</span> <span class="n">MSVC_INCDIR</span><span class="p">,</span> <span class="n">MSVC_LIBDIR</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="gather_wsdk_versions"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.gather_wsdk_versions">[docs]</a><span class="k">def</span> <span class="nf">gather_wsdk_versions</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Use winreg to add the msvc versions to the input list</span>

<span class="sd">	:param versions: list to modify</span>
<span class="sd">	:type versions: list</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">version_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^v..?.?\...?.?&#39;</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">all_versions</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Wow6432node</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">Microsoft SDKs</span><span class="se">\\</span><span class="s">Windows&#39;</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">all_versions</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">Microsoft SDKs</span><span class="se">\\</span><span class="s">Windows&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">return</span>
	<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">version</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">EnumKey</span><span class="p">(</span><span class="n">all_versions</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">break</span>
		<span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">version_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
			<span class="k">continue</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">msvc_version</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">all_versions</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
			<span class="n">path</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">QueryValueEx</span><span class="p">(</span><span class="n">msvc_version</span><span class="p">,</span><span class="s">&#39;InstallationFolder&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="s">&#39;SetEnv.cmd&#39;</span><span class="p">)):</span>
			<span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">target</span><span class="p">,</span><span class="n">arch</span> <span class="ow">in</span> <span class="n">all_msvc_platforms</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_msvc_version</span><span class="p">(</span><span class="s">&#39;wsdk&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">target</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="s">&#39;SetEnv.cmd&#39;</span><span class="p">)))))</span>
				<span class="k">except</span> <span class="n">conf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;wsdk &#39;</span> <span class="o">+</span> <span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">targets</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="gather_wince_supported_platforms"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.gather_wince_supported_platforms">[docs]</a><span class="k">def</span> <span class="nf">gather_wince_supported_platforms</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Checks SmartPhones SDKs</span>

<span class="sd">	:param versions: list to modify</span>
<span class="sd">	:type versions: list</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">supported_wince_platforms</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">ce_sdk</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Wow6432node</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">Windows CE Tools</span><span class="se">\\</span><span class="s">SDKs&#39;</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">ce_sdk</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">Windows CE Tools</span><span class="se">\\</span><span class="s">SDKs&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="n">ce_sdk</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">ce_sdk</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">supported_wince_platforms</span>

	<span class="n">ce_index</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">sdk_device</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">EnumKey</span><span class="p">(</span><span class="n">ce_sdk</span><span class="p">,</span> <span class="n">ce_index</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">break</span>
		<span class="n">ce_index</span> <span class="o">=</span> <span class="n">ce_index</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">sdk</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">ce_sdk</span><span class="p">,</span> <span class="n">sdk_device</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">path</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">QueryValueEx</span><span class="p">(</span><span class="n">sdk</span><span class="p">,</span> <span class="s">&#39;SDKRootDir&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="n">path</span><span class="p">,</span><span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="p">:</span>
			<span class="n">path</span><span class="p">,</span><span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">arch</span><span class="p">,</span><span class="n">compiler</span> <span class="ow">in</span> <span class="n">all_wince_platforms</span><span class="p">:</span>
			<span class="n">platforms</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s">&#39;Lib&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="p">)):</span>
				<span class="n">platforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">arch</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s">&#39;Include&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s">&#39;Lib&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="p">)))</span>
			<span class="k">if</span> <span class="n">platforms</span><span class="p">:</span>
				<span class="n">supported_wince_platforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">device</span><span class="p">,</span> <span class="n">platforms</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">supported_wince_platforms</span>
</div>
<span class="k">def</span> <span class="nf">gather_msvc_detected_versions</span><span class="p">():</span>
	<span class="c">#Detected MSVC versions!</span>
	<span class="n">version_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^(\d\d?\.\d\d?)(Exp)?$&#39;</span><span class="p">)</span>
	<span class="n">detected_versions</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">vcver</span><span class="p">,</span><span class="n">vcvar</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&#39;VCExpress&#39;</span><span class="p">,</span><span class="s">&#39;Exp&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;VisualStudio&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)]:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Wow6432node</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">&#39;</span><span class="o">+</span><span class="n">vcver</span>
			<span class="n">all_versions</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">&#39;</span><span class="o">+</span><span class="n">vcver</span>
				<span class="n">all_versions</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
				<span class="k">continue</span>

		<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">version</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">EnumKey</span><span class="p">(</span><span class="n">all_versions</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
				<span class="k">break</span>
			<span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">match</span> <span class="o">=</span> <span class="n">version_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">versionnumber</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
			<span class="n">detected_versions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">versionnumber</span><span class="p">,</span> <span class="n">version</span><span class="o">+</span><span class="n">vcvar</span><span class="p">,</span> <span class="n">prefix</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="o">+</span><span class="n">version</span><span class="p">))</span>
	<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">tup</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">detected_versions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">fun</span><span class="p">)</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="c"># old python sort</span>
		<span class="n">detected_versions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
	<span class="k">return</span> <span class="n">detected_versions</span>

<span class="nd">@conf</span>
<div class="viewcode-block" id="gather_msvc_targets"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.gather_msvc_targets">[docs]</a><span class="k">def</span> <span class="nf">gather_msvc_targets</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">vc_path</span><span class="p">):</span>
	<span class="c">#Looking for normal MSVC compilers!</span>
	<span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vc_path</span><span class="p">,</span> <span class="s">&#39;vcvarsall.bat&#39;</span><span class="p">)):</span>
		<span class="k">for</span> <span class="n">target</span><span class="p">,</span><span class="n">realtarget</span> <span class="ow">in</span> <span class="n">all_msvc_platforms</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="p">(</span><span class="n">realtarget</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_msvc_version</span><span class="p">(</span><span class="s">&#39;msvc&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vc_path</span><span class="p">,</span> <span class="s">&#39;vcvarsall.bat&#39;</span><span class="p">)))))</span>
			<span class="k">except</span> <span class="n">conf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
				<span class="k">pass</span>
	<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vc_path</span><span class="p">,</span> <span class="s">&#39;Common7&#39;</span><span class="p">,</span> <span class="s">&#39;Tools&#39;</span><span class="p">,</span> <span class="s">&#39;vsvars32.bat&#39;</span><span class="p">)):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_msvc_version</span><span class="p">(</span><span class="s">&#39;msvc&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vc_path</span><span class="p">,</span> <span class="s">&#39;Common7&#39;</span><span class="p">,</span> <span class="s">&#39;Tools&#39;</span><span class="p">,</span> <span class="s">&#39;vsvars32.bat&#39;</span><span class="p">)))))</span>
		<span class="k">except</span> <span class="n">conf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vc_path</span><span class="p">,</span> <span class="s">&#39;Bin&#39;</span><span class="p">,</span> <span class="s">&#39;vcvars32.bat&#39;</span><span class="p">)):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_msvc_version</span><span class="p">(</span><span class="s">&#39;msvc&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vc_path</span><span class="p">,</span> <span class="s">&#39;Bin&#39;</span><span class="p">,</span> <span class="s">&#39;vcvars32.bat&#39;</span><span class="p">)))))</span>
		<span class="k">except</span> <span class="n">conf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;msvc &#39;</span><span class="o">+</span> <span class="n">version</span><span class="p">,</span> <span class="n">targets</span><span class="p">))</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="gather_wince_targets"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.gather_wince_targets">[docs]</a><span class="k">def</span> <span class="nf">gather_wince_targets</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">versions</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">vc_path</span><span class="p">,</span> <span class="n">vsvars</span><span class="p">,</span> <span class="n">supported_platforms</span><span class="p">):</span>
	<span class="c">#Looking for Win CE compilers!</span>
	<span class="k">for</span> <span class="n">device</span><span class="p">,</span><span class="n">platforms</span> <span class="ow">in</span> <span class="n">supported_platforms</span><span class="p">:</span>
		<span class="n">cetargets</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">platform</span><span class="p">,</span><span class="n">compiler</span><span class="p">,</span><span class="n">include</span><span class="p">,</span><span class="n">lib</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
			<span class="n">winCEpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vc_path</span><span class="p">,</span> <span class="s">&#39;ce&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">common_bindirs</span><span class="p">,</span><span class="n">_1</span><span class="p">,</span><span class="n">_2</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_msvc_version</span><span class="p">(</span><span class="s">&#39;msvc&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="s">&#39;x86&#39;</span><span class="p">,</span> <span class="n">vsvars</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">conf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="p">)):</span>
				<span class="n">bindirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="n">compiler</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="s">&#39;x86_&#39;</span><span class="o">+</span><span class="n">compiler</span><span class="p">)]</span> <span class="o">+</span> <span class="n">common_bindirs</span>
				<span class="n">incdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">include</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">,</span> <span class="s">&#39;include&#39;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">,</span> <span class="s">&#39;atlmfc&#39;</span><span class="p">,</span> <span class="s">&#39;include&#39;</span><span class="p">)]</span>
				<span class="n">libdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">lib</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">winCEpath</span><span class="p">,</span> <span class="s">&#39;atlmfc&#39;</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="p">)]</span>
				<span class="n">cetargets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">platform</span><span class="p">,</span> <span class="p">(</span><span class="n">platform</span><span class="p">,</span> <span class="p">(</span><span class="n">bindirs</span><span class="p">,</span><span class="n">incdirs</span><span class="p">,</span><span class="n">libdirs</span><span class="p">))))</span>
		<span class="k">if</span> <span class="n">cetargets</span><span class="p">:</span>
			<span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">device</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">version</span><span class="p">,</span> <span class="n">cetargets</span><span class="p">))</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="gather_msvc_versions"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.gather_msvc_versions">[docs]</a><span class="k">def</span> <span class="nf">gather_msvc_versions</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
	<span class="n">vc_paths</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">reg</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gather_msvc_detected_versions</span><span class="p">():</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">msvc_version</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">reg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">Setup</span><span class="se">\\</span><span class="s">VC&quot;</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
				<span class="n">msvc_version</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">reg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">Setup</span><span class="se">\\</span><span class="s">Microsoft Visual C++&quot;</span><span class="p">)</span>
			<span class="n">path</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">QueryValueEx</span><span class="p">(</span><span class="n">msvc_version</span><span class="p">,</span> <span class="s">&#39;ProductDir&#39;</span><span class="p">)</span>
			<span class="n">vc_paths</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">version</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))))</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">continue</span>

	<span class="n">wince_supported_platforms</span> <span class="o">=</span> <span class="n">gather_wince_supported_platforms</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">version</span><span class="p">,</span><span class="n">vc_path</span> <span class="ow">in</span> <span class="n">vc_paths</span><span class="p">:</span>
		<span class="n">vs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">vc_path</span><span class="p">)</span>
		<span class="n">vsvars</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vs_path</span><span class="p">,</span> <span class="s">&#39;Common7&#39;</span><span class="p">,</span> <span class="s">&#39;Tools&#39;</span><span class="p">,</span> <span class="s">&#39;vsvars32.bat&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">wince_supported_platforms</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">vsvars</span><span class="p">):</span>
			<span class="n">conf</span><span class="o">.</span><span class="n">gather_wince_targets</span><span class="p">(</span><span class="n">versions</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">vc_path</span><span class="p">,</span> <span class="n">vsvars</span><span class="p">,</span> <span class="n">wince_supported_platforms</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">version</span><span class="p">,</span><span class="n">vc_path</span> <span class="ow">in</span> <span class="n">vc_paths</span><span class="p">:</span>
		<span class="n">vs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">vc_path</span><span class="p">)</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">gather_msvc_targets</span><span class="p">(</span><span class="n">versions</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">vc_path</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="gather_icl_versions"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.gather_icl_versions">[docs]</a><span class="k">def</span> <span class="nf">gather_icl_versions</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Checks ICL compilers</span>

<span class="sd">	:param versions: list to modify</span>
<span class="sd">	:type versions: list</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">version_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^...?.?\....?.?&#39;</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">all_versions</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Wow6432node</span><span class="se">\\</span><span class="s">Intel</span><span class="se">\\</span><span class="s">Compilers</span><span class="se">\\</span><span class="s">C++&#39;</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">all_versions</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">_winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Intel</span><span class="se">\\</span><span class="s">Compilers</span><span class="se">\\</span><span class="s">C++&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">return</span>
	<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">version</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">EnumKey</span><span class="p">(</span><span class="n">all_versions</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
			<span class="k">break</span>
		<span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">version_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
			<span class="k">continue</span>
		<span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">target</span><span class="p">,</span><span class="n">arch</span> <span class="ow">in</span> <span class="n">all_icl_platforms</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">target</span><span class="o">==</span><span class="s">&#39;intel64&#39;</span><span class="p">:</span> <span class="n">targetDir</span><span class="o">=</span><span class="s">&#39;EM64T_NATIVE&#39;</span>
				<span class="k">else</span><span class="p">:</span> <span class="n">targetDir</span><span class="o">=</span><span class="n">target</span>
				<span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">all_versions</span><span class="p">,</span><span class="n">version</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="o">+</span><span class="n">targetDir</span><span class="p">)</span>
				<span class="n">icl_version</span><span class="o">=</span><span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">all_versions</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
				<span class="n">path</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="n">_winreg</span><span class="o">.</span><span class="n">QueryValueEx</span><span class="p">(</span><span class="n">icl_version</span><span class="p">,</span><span class="s">&#39;ProductDir&#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;bin&#39;</span><span class="p">,</span><span class="s">&#39;iclvars.bat&#39;</span><span class="p">)):</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,(</span><span class="n">arch</span><span class="p">,</span><span class="n">conf</span><span class="o">.</span><span class="n">get_msvc_version</span><span class="p">(</span><span class="s">&#39;intel&#39;</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">target</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;bin&#39;</span><span class="p">,</span><span class="s">&#39;iclvars.bat&#39;</span><span class="p">)))))</span>
					<span class="k">except</span> <span class="n">conf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
						<span class="k">pass</span>
			<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="k">for</span> <span class="n">target</span><span class="p">,</span><span class="n">arch</span> <span class="ow">in</span> <span class="n">all_icl_platforms</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">icl_version</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">all_versions</span><span class="p">,</span> <span class="n">version</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="o">+</span><span class="n">target</span><span class="p">)</span>
				<span class="n">path</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="n">_winreg</span><span class="o">.</span><span class="n">QueryValueEx</span><span class="p">(</span><span class="n">icl_version</span><span class="p">,</span><span class="s">&#39;ProductDir&#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="s">&#39;iclvars.bat&#39;</span><span class="p">)):</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_msvc_version</span><span class="p">(</span><span class="s">&#39;intel&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="s">&#39;iclvars.bat&#39;</span><span class="p">)))))</span>
					<span class="k">except</span> <span class="n">conf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">:</span>
						<span class="k">pass</span>
			<span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
				<span class="k">continue</span>
		<span class="n">major</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;intel &#39;</span> <span class="o">+</span> <span class="n">major</span><span class="p">,</span> <span class="n">targets</span><span class="p">))</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="get_msvc_versions"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.get_msvc_versions">[docs]</a><span class="k">def</span> <span class="nf">get_msvc_versions</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:return: list of compilers installed</span>
<span class="sd">	:rtype: list of string</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MSVC_INSTALLED_VERSIONS&#39;</span><span class="p">]:</span>
		<span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">gather_icl_versions</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">gather_wsdk_versions</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">gather_msvc_versions</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MSVC_INSTALLED_VERSIONS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lst</span>
	<span class="k">return</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MSVC_INSTALLED_VERSIONS&#39;</span><span class="p">]</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="print_all_msvc_detected"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.print_all_msvc_detected">[docs]</a><span class="k">def</span> <span class="nf">print_all_msvc_detected</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Print the contents of *conf.env.MSVC_INSTALLED_VERSIONS*</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="n">version</span><span class="p">,</span><span class="n">targets</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MSVC_INSTALLED_VERSIONS&#39;</span><span class="p">]:</span>
		<span class="n">info</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">target</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
			<span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">+</span><span class="n">target</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="detect_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.detect_msvc">[docs]</a><span class="k">def</span> <span class="nf">detect_msvc</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="n">versions</span> <span class="o">=</span> <span class="n">get_msvc_versions</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">setup_msvc</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">versions</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="find_lt_names_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.find_lt_names_msvc">[docs]</a><span class="k">def</span> <span class="nf">find_lt_names_msvc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libname</span><span class="p">,</span> <span class="n">is_static</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Win32/MSVC specific code to glean out information from libtool la files.</span>
<span class="sd">	this function is not attached to the task_gen class</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">lt_names</span><span class="o">=</span><span class="p">[</span>
		<span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.la&#39;</span> <span class="o">%</span> <span class="n">libname</span><span class="p">,</span>
		<span class="s">&#39;</span><span class="si">%s</span><span class="s">.la&#39;</span> <span class="o">%</span> <span class="n">libname</span><span class="p">,</span>
	<span class="p">]</span>

	<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;LIBPATH&#39;</span><span class="p">]:</span>
		<span class="k">for</span> <span class="n">la</span> <span class="ow">in</span> <span class="n">lt_names</span><span class="p">:</span>
			<span class="n">laf</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">la</span><span class="p">)</span>
			<span class="n">dll</span><span class="o">=</span><span class="bp">None</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">laf</span><span class="p">):</span>
				<span class="n">ltdict</span> <span class="o">=</span> <span class="n">Utils</span><span class="o">.</span><span class="n">read_la_file</span><span class="p">(</span><span class="n">laf</span><span class="p">)</span>
				<span class="n">lt_libdir</span><span class="o">=</span><span class="bp">None</span>
				<span class="k">if</span> <span class="n">ltdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;libdir&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
					<span class="n">lt_libdir</span> <span class="o">=</span> <span class="n">ltdict</span><span class="p">[</span><span class="s">&#39;libdir&#39;</span><span class="p">]</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">is_static</span> <span class="ow">and</span> <span class="n">ltdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;library_names&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
					<span class="n">dllnames</span><span class="o">=</span><span class="n">ltdict</span><span class="p">[</span><span class="s">&#39;library_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
					<span class="n">dll</span><span class="o">=</span><span class="n">dllnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
					<span class="n">dll</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\.dll$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dll</span><span class="p">)</span>
					<span class="k">return</span> <span class="p">(</span><span class="n">lt_libdir</span><span class="p">,</span> <span class="n">dll</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
				<span class="k">elif</span> <span class="n">ltdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;old_library&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
					<span class="n">olib</span><span class="o">=</span><span class="n">ltdict</span><span class="p">[</span><span class="s">&#39;old_library&#39;</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">olib</span><span class="p">)):</span>
						<span class="k">return</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">olib</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
					<span class="k">elif</span> <span class="n">lt_libdir</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lt_libdir</span><span class="p">,</span><span class="n">olib</span><span class="p">)):</span>
						<span class="k">return</span> <span class="p">(</span><span class="n">lt_libdir</span><span class="p">,</span> <span class="n">olib</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">olib</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">WafError</span><span class="p">(</span><span class="s">&#39;invalid libtool object file: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">laf</span><span class="p">)</span>
	<span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="libname_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.libname_msvc">[docs]</a><span class="k">def</span> <span class="nf">libname_msvc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libname</span><span class="p">,</span> <span class="n">is_static</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="n">lib</span> <span class="o">=</span> <span class="n">libname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
	<span class="n">lib</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\.lib$&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">lib</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">g_msvc_systemlibs</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">lib</span>

	<span class="n">lib</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;^lib&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">lib</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">lib</span> <span class="o">==</span> <span class="s">&#39;m&#39;</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">None</span>

	<span class="p">(</span><span class="n">lt_path</span><span class="p">,</span> <span class="n">lt_libname</span><span class="p">,</span> <span class="n">lt_static</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_lt_names_msvc</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">is_static</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">lt_path</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lt_libname</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">lt_static</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
			<span class="c"># file existance check has been made by find_lt_names</span>
			<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lt_path</span><span class="p">,</span><span class="n">lt_libname</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">lt_path</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">_libpaths</span><span class="o">=</span><span class="p">[</span><span class="n">lt_path</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;LIBPATH&#39;</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">_libpaths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;LIBPATH&#39;</span><span class="p">]</span>

	<span class="n">static_libs</span><span class="o">=</span><span class="p">[</span>
		<span class="s">&#39;lib</span><span class="si">%s</span><span class="s">s.lib&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.lib&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;</span><span class="si">%s</span><span class="s">s.lib&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;</span><span class="si">%s</span><span class="s">.lib&#39;</span> <span class="o">%</span><span class="n">lib</span><span class="p">,</span>
		<span class="p">]</span>

	<span class="n">dynamic_libs</span><span class="o">=</span><span class="p">[</span>
		<span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.dll.lib&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.dll.a&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;</span><span class="si">%s</span><span class="s">.dll.lib&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;</span><span class="si">%s</span><span class="s">.dll.a&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;lib</span><span class="si">%s</span><span class="s">_d.lib&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;</span><span class="si">%s</span><span class="s">_d.lib&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">,</span>
		<span class="s">&#39;</span><span class="si">%s</span><span class="s">.lib&#39;</span> <span class="o">%</span><span class="n">lib</span><span class="p">,</span>
		<span class="p">]</span>

	<span class="n">libnames</span><span class="o">=</span><span class="n">static_libs</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">is_static</span><span class="p">:</span>
		<span class="n">libnames</span><span class="o">=</span><span class="n">dynamic_libs</span> <span class="o">+</span> <span class="n">static_libs</span>

	<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">_libpaths</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">libn</span> <span class="ow">in</span> <span class="n">libnames</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">libn</span><span class="p">)):</span>
				<span class="n">debug</span><span class="p">(</span><span class="s">&#39;msvc: lib found: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">libn</span><span class="p">))</span>
				<span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\.lib$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">libn</span><span class="p">)</span>

	<span class="c">#if no lib can be found, just return the libname as msvc expects it</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;The library </span><span class="si">%r</span><span class="s"> could not be found&quot;</span> <span class="o">%</span> <span class="n">libname</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\.lib$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">libname</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="check_lib_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.check_lib_msvc">[docs]</a><span class="k">def</span> <span class="nf">check_lib_msvc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libname</span><span class="p">,</span> <span class="n">is_static</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">uselib_store</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Ideally we should be able to place the lib in the right env var, either STLIB or LIB,</span>
<span class="sd">	but we don&#39;t distinguish static libs from shared libs.</span>
<span class="sd">	This is ok since msvc doesn&#39;t have any special linker flag to select static libs (no env[&#39;STLIB_MARKER&#39;])</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">libn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">libname_msvc</span><span class="p">(</span><span class="n">libname</span><span class="p">,</span> <span class="n">is_static</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">uselib_store</span><span class="p">:</span>
		<span class="n">uselib_store</span> <span class="o">=</span> <span class="n">libname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

	<span class="k">if</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">is_static</span><span class="p">:</span> <span class="c"># disabled</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;STLIB_&#39;</span> <span class="o">+</span> <span class="n">uselib_store</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">libn</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;LIB_&#39;</span> <span class="o">+</span> <span class="n">uselib_store</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">libn</span><span class="p">]</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="check_libs_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.check_libs_msvc">[docs]</a><span class="k">def</span> <span class="nf">check_libs_msvc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libnames</span><span class="p">,</span> <span class="n">is_static</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">libname</span> <span class="ow">in</span> <span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">libnames</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check_lib_msvc</span><span class="p">(</span><span class="n">libname</span><span class="p">,</span> <span class="n">is_static</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="configure"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.configure">[docs]</a><span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Configuration methods to call for detecting msvc</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">autodetect</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">find_msvc</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">msvc_common_flags</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">cc_load_tools</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">cxx_load_tools</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">cc_add_flags</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">cxx_add_flags</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">link_add_flags</span><span class="p">()</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">visual_studio_add_flags</span><span class="p">()</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="no_autodetect"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.no_autodetect">[docs]</a><span class="k">def</span> <span class="nf">no_autodetect</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">NO_MSVC_DETECT</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">configure</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="autodetect"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.autodetect">[docs]</a><span class="k">def</span> <span class="nf">autodetect</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span>
	<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">NO_MSVC_DETECT</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">compiler</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">includes</span><span class="p">,</span> <span class="n">libdirs</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">detect_msvc</span><span class="p">()</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;INCLUDES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">includes</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;LIBPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libdirs</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_COMPILER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_VERSION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_VERSION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">version</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
</div>
<span class="k">def</span> <span class="nf">_get_prog_names</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">compiler</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">compiler</span><span class="o">==</span><span class="s">&#39;intel&#39;</span><span class="p">:</span>
		<span class="n">compiler_name</span> <span class="o">=</span> <span class="s">&#39;ICL&#39;</span>
		<span class="n">linker_name</span> <span class="o">=</span> <span class="s">&#39;XILINK&#39;</span>
		<span class="n">lib_name</span> <span class="o">=</span> <span class="s">&#39;XILIB&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="c"># assumes CL.exe</span>
		<span class="n">compiler_name</span> <span class="o">=</span> <span class="s">&#39;CL&#39;</span>
		<span class="n">linker_name</span> <span class="o">=</span> <span class="s">&#39;LINK&#39;</span>
		<span class="n">lib_name</span> <span class="o">=</span> <span class="s">&#39;LIB&#39;</span>
	<span class="k">return</span> <span class="n">compiler_name</span><span class="p">,</span> <span class="n">linker_name</span><span class="p">,</span> <span class="n">lib_name</span>

<span class="nd">@conf</span>
<div class="viewcode-block" id="find_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.find_msvc">[docs]</a><span class="k">def</span> <span class="nf">find_msvc</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Due to path format limitations, limit operation only to native Win32. Yeah it sucks.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;cygwin&#39;</span><span class="p">:</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;MSVC module does not work under cygwin Python!&#39;</span><span class="p">)</span>

	<span class="c"># the autodetection is supposed to be performed before entering in this method</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span>
	<span class="n">path</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;PATH&#39;</span><span class="p">]</span>
	<span class="n">compiler</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_COMPILER&#39;</span><span class="p">]</span>
	<span class="n">version</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_VERSION&#39;</span><span class="p">]</span>

	<span class="n">compiler_name</span><span class="p">,</span> <span class="n">linker_name</span><span class="p">,</span> <span class="n">lib_name</span> <span class="o">=</span> <span class="n">_get_prog_names</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">compiler</span><span class="p">)</span>
	<span class="n">v</span><span class="o">.</span><span class="n">MSVC_MANIFEST</span> <span class="o">=</span> <span class="p">(</span><span class="n">compiler</span> <span class="o">==</span> <span class="s">&#39;msvc&#39;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">compiler</span> <span class="o">==</span> <span class="s">&#39;wsdk&#39;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">compiler</span> <span class="o">==</span> <span class="s">&#39;intel&#39;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">11</span><span class="p">)</span>

	<span class="c"># compiler</span>
	<span class="n">cxx</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX&#39;</span><span class="p">]:</span> <span class="n">cxx</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX&#39;</span><span class="p">]</span>
	<span class="k">elif</span> <span class="s">&#39;CXX&#39;</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span> <span class="n">cxx</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;CXX&#39;</span><span class="p">]</span>
	<span class="n">cxx</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">find_program</span><span class="p">(</span><span class="n">compiler_name</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;CXX&#39;</span><span class="p">,</span> <span class="n">path_list</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
	<span class="n">cxx</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">cmd_to_list</span><span class="p">(</span><span class="n">cxx</span><span class="p">)</span>

	<span class="c"># before setting anything, check if the compiler is really msvc</span>
	<span class="n">env</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">path</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">PATH</span> <span class="o">=</span> <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">cmd_and_log</span><span class="p">(</span><span class="n">cxx</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;/nologo&#39;</span><span class="p">,</span> <span class="s">&#39;/help&#39;</span><span class="p">],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">):</span>
		<span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;the msvc compiler could not be identified&#39;</span><span class="p">)</span>

	<span class="c"># c/c++ compiler</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxx</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CC_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;msvc&#39;</span>

	<span class="c"># linker</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;LINK_CXX&#39;</span><span class="p">]:</span>
		<span class="n">link</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">find_program</span><span class="p">(</span><span class="n">linker_name</span><span class="p">,</span> <span class="n">path_list</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">link</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;LINK_CXX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span>
		<span class="k">else</span><span class="p">:</span> <span class="n">conf</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> was not found (linker)&#39;</span> <span class="o">%</span> <span class="n">linker_name</span><span class="p">)</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;LINK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;LINK_CC&#39;</span><span class="p">]:</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;LINK_CC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;LINK_CXX&#39;</span><span class="p">]</span>

	<span class="c"># staticlib linker</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;AR&#39;</span><span class="p">]:</span>
		<span class="n">stliblink</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">find_program</span><span class="p">(</span><span class="n">lib_name</span><span class="p">,</span> <span class="n">path_list</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;AR&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">stliblink</span><span class="p">:</span> <span class="k">return</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;ARFLAGS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/NOLOGO&#39;</span><span class="p">]</span>

	<span class="c"># manifest tool. Not required for VS 2003 and below. Must have for VS 2005 and later</span>
	<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">MSVC_MANIFEST</span><span class="p">:</span>
		<span class="n">mt</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">find_program</span><span class="p">(</span><span class="s">&#39;MT&#39;</span><span class="p">,</span> <span class="n">path_list</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;MT&#39;</span><span class="p">)</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;MTFLAGS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/NOLOGO&#39;</span><span class="p">]</span>

	<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;winres&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;WINRC&#39;</span><span class="p">]:</span>
		<span class="n">warn</span><span class="p">(</span><span class="s">&#39;Resource compiler not found. Compiling resource file is disabled&#39;</span><span class="p">)</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="visual_studio_add_flags"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.visual_studio_add_flags">[docs]</a><span class="k">def</span> <span class="nf">visual_studio_add_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;visual studio flags found in the system environment&quot;&quot;&quot;</span>
	<span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>
	<span class="k">try</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">prepend_value</span><span class="p">(</span><span class="s">&#39;INCLUDES&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;INCLUDE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">))</span> <span class="c"># notice the &#39;S&#39;</span>
	<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
	<span class="k">try</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">prepend_value</span><span class="p">(</span><span class="s">&#39;LIBPATH&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;LIB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">))</span>
	<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</div>
<span class="nd">@conf</span>
<div class="viewcode-block" id="msvc_common_flags"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.msvc_common_flags">[docs]</a><span class="k">def</span> <span class="nf">msvc_common_flags</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Setup the flags required for executing the msvc compiler</span>

<span class="sd">	The default is to allow a static and a shared library having the same name in the same directory, the static one being prefixed by &#39;lib&#39;. If you feel that this</span>
<span class="sd">	is incorrect, just change the extension (issue #824)::</span>

<span class="sd">		bld.env.STLIB_ST = bld.env.SHLIB_ST = &#39;%s.lib&#39;</span>
<span class="sd">		bld.stlib(..., name=&#39;libfoo&#39;)</span>
<span class="sd">		bld.shlib(..., name=&#39;foo&#39;)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">env</span>

	<span class="n">v</span><span class="p">[</span><span class="s">&#39;DEST_BINFMT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;pe&#39;</span>
	<span class="n">v</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;CFLAGS&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;/nologo&#39;</span><span class="p">])</span>
	<span class="n">v</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;CXXFLAGS&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;/nologo&#39;</span><span class="p">])</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;DEFINES_ST&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="s">&#39;/D</span><span class="si">%s</span><span class="s">&#39;</span>

	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CC_SRC_F&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="s">&#39;&#39;</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CC_TGT_F&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/c&#39;</span><span class="p">,</span> <span class="s">&#39;/Fo&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_VERSION&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;CC_TGT_F&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;/FC&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CC_TGT_F&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX_SRC_F&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="s">&#39;&#39;</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX_TGT_F&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/c&#39;</span><span class="p">,</span> <span class="s">&#39;/Fo&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_VERSION&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
		<span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX_TGT_F&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;/FC&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXX_TGT_F&#39;</span><span class="p">]</span>

	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CPPPATH_ST&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s">&#39;/I</span><span class="si">%s</span><span class="s">&#39;</span> <span class="c"># template for adding include paths</span>

	<span class="n">v</span><span class="p">[</span><span class="s">&#39;AR_TGT_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CCLNK_TGT_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXLNK_TGT_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;/OUT:&#39;</span>

	<span class="c"># Subsystem specific flags</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_CONSOLE&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_CONSOLE&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/SUBSYSTEM:CONSOLE&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_NATIVE&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_NATIVE&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/SUBSYSTEM:NATIVE&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_POSIX&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_POSIX&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/SUBSYSTEM:POSIX&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_WINDOWS&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_WINDOWS&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/SUBSYSTEM:WINDOWS&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_WINDOWSCE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_WINDOWSCE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/SUBSYSTEM:WINDOWSCE&#39;</span><span class="p">]</span>

	<span class="c"># CRT specific flags</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_CRT_MULTITHREADED&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_CRT_MULTITHREADED&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/MT&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_CRT_MULTITHREADED_DLL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_CRT_MULTITHREADED_DLL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/MD&#39;</span><span class="p">]</span>

	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_CRT_MULTITHREADED_DBG&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_CRT_MULTITHREADED_DBG&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/MTd&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_CRT_MULTITHREADED_DLL_DBG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_CRT_MULTITHREADED_DLL_DBG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/MDd&#39;</span><span class="p">]</span>

	<span class="c"># linker</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;LIB_ST&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.lib&#39;</span> <span class="c"># template for adding shared libs</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;LIBPATH_ST&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="s">&#39;/LIBPATH:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="c"># template for adding libpaths</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;STLIB_ST&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.lib&#39;</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;STLIBPATH_ST&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s">&#39;/LIBPATH:</span><span class="si">%s</span><span class="s">&#39;</span>

	<span class="n">v</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;/NOLOGO&#39;</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;MSVC_MANIFEST&#39;</span><span class="p">]:</span>
		<span class="n">v</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="s">&#39;LINKFLAGS&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;/MANIFEST&#39;</span><span class="p">])</span>

	<span class="c"># shared library</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CFLAGS_cshlib&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;CXXFLAGS_cxxshlib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;LINKFLAGS_cshlib&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;LINKFLAGS_cxxshlib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/DLL&#39;</span><span class="p">]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;cshlib_PATTERN&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;cxxshlib_PATTERN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.dll&#39;</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;implib_PATTERN&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.lib&#39;</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;IMPLIB_ST&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="s">&#39;/IMPLIB:</span><span class="si">%s</span><span class="s">&#39;</span>

	<span class="c"># static library</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;LINKFLAGS_cstlib&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">[]</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;cstlib_PATTERN&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;cxxstlib_PATTERN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;lib</span><span class="si">%s</span><span class="s">.lib&#39;</span>

	<span class="c"># program</span>
	<span class="n">v</span><span class="p">[</span><span class="s">&#39;cprogram_PATTERN&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;cxxprogram_PATTERN&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.exe&#39;</span>


<span class="c">#######################################################################################################</span>
<span class="c">##### conf above, build below</span>
</div>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;apply_link&#39;</span><span class="p">)</span>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;cxx&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="apply_flags_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.apply_flags_msvc">[docs]</a><span class="k">def</span> <span class="nf">apply_flags_msvc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Add additional flags implied by msvc, such as subsystems and pdb files::</span>

<span class="sd">		def build(bld):</span>
<span class="sd">			bld.stlib(source=&#39;main.c&#39;, target=&#39;bar&#39;, subsystem=&#39;gruik&#39;)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CC_NAME</span> <span class="o">!=</span> <span class="s">&#39;msvc&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;link_task&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
		<span class="k">return</span>

	<span class="n">is_static</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="p">,</span> <span class="n">ccroot</span><span class="o">.</span><span class="n">stlink_task</span><span class="p">)</span>

	<span class="n">subsystem</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;subsystem&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">subsystem</span><span class="p">:</span>
		<span class="n">subsystem</span> <span class="o">=</span> <span class="s">&#39;/subsystem:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">subsystem</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="n">is_static</span> <span class="ow">and</span> <span class="s">&#39;ARFLAGS&#39;</span> <span class="ow">or</span> <span class="s">&#39;LINKFLAGS&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">subsystem</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">is_static</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">LINKFLAGS</span><span class="p">:</span>
			<span class="n">d</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;debug&#39;</span><span class="p">:</span>
				<span class="n">pdbnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">change_ext</span><span class="p">(</span><span class="s">&#39;.pdb&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdbnode</span><span class="p">)</span>

				<span class="k">try</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">install_task</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdbnode</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
					<span class="k">pass</span>

				<span class="k">break</span>

<span class="c"># split the manifest file processing from the link task, like for the rc processing</span>
</div>
<span class="nd">@feature</span><span class="p">(</span><span class="s">&#39;cprogram&#39;</span><span class="p">,</span> <span class="s">&#39;cshlib&#39;</span><span class="p">,</span> <span class="s">&#39;cxxprogram&#39;</span><span class="p">,</span> <span class="s">&#39;cxxshlib&#39;</span><span class="p">)</span>
<span class="nd">@after_method</span><span class="p">(</span><span class="s">&#39;apply_link&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="apply_manifest"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.apply_manifest">[docs]</a><span class="k">def</span> <span class="nf">apply_manifest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Special linker for MSVC with support for embedding manifests into DLL&#39;s</span>
<span class="sd">	and executables compiled by Visual Studio 2005 or probably later. Without</span>
<span class="sd">	the manifest file, the binaries are unusable.</span>
<span class="sd">	See: http://msdn2.microsoft.com/en-us/library/ms235542(VS.80).aspx</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CC_NAME</span> <span class="o">==</span> <span class="s">&#39;msvc&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">MSVC_MANIFEST</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;link_task&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
		<span class="n">out_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">man_node</span> <span class="o">=</span> <span class="n">out_node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">find_or_declare</span><span class="p">(</span><span class="n">out_node</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.manifest&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">man_node</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">link_task</span><span class="o">.</span><span class="n">do_manifest</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="exec_mf"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.exec_mf">[docs]</a><span class="k">def</span> <span class="nf">exec_mf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create the manifest file</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>
	<span class="n">mtool</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;MT&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">mtool</span><span class="p">:</span>
		<span class="k">return</span> <span class="mi">0</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">do_manifest</span> <span class="o">=</span> <span class="bp">False</span>

	<span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abspath</span><span class="p">()</span>

	<span class="n">manifest</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">for</span> <span class="n">out_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">out_node</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.manifest&#39;</span><span class="p">):</span>
			<span class="n">manifest</span> <span class="o">=</span> <span class="n">out_node</span><span class="o">.</span><span class="n">abspath</span><span class="p">()</span>
			<span class="k">break</span>
	<span class="k">if</span> <span class="n">manifest</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
		<span class="c"># Should never get here.  If we do, it means the manifest file was</span>
		<span class="c"># never added to the outputs list, thus we don&#39;t have a manifest file</span>
		<span class="c"># to embed, so we just return.</span>
		<span class="k">return</span> <span class="mi">0</span>

	<span class="c"># embedding mode. Different for EXE&#39;s and DLL&#39;s.</span>
	<span class="c"># see: http://msdn2.microsoft.com/en-us/library/ms235591(VS.80).aspx</span>
	<span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
	<span class="k">if</span> <span class="s">&#39;cprogram&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">features</span> <span class="ow">or</span> <span class="s">&#39;cxxprogram&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>
	<span class="k">elif</span> <span class="s">&#39;cshlib&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">features</span> <span class="ow">or</span> <span class="s">&#39;cxxshlib&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;2&#39;</span>

	<span class="n">debug</span><span class="p">(</span><span class="s">&#39;msvc: embedding manifest in mode </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

	<span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MT&#39;</span><span class="p">])</span>
	<span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Utils</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;MTFLAGS&#39;</span><span class="p">]))</span>
	<span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;-manifest&#39;</span><span class="p">,</span> <span class="n">manifest</span><span class="p">])</span>
	<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-outputresource:</span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span>

	<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">lst</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="o">*</span><span class="n">lst</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">quote_response_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">flag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;/LIBPATH:&#39;</span><span class="p">,</span> <span class="s">&#39;/IMPLIB:&#39;</span><span class="p">,</span> <span class="s">&#39;/OUT:&#39;</span><span class="p">,</span> <span class="s">&#39;/I&#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">flag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
				<span class="n">flag</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):])</span>
				<span class="k">break</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">flag</span> <span class="o">=</span> <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">flag</span>
	<span class="k">return</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">exec_response_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="c"># not public yet</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">8192</span><span class="p">:</span>
			<span class="n">program</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c">#unquoted program name, otherwise exec_command will fail</span>
			<span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">quote_response_command</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">]</span>
			<span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
			<span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
			<span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
			<span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">program</span><span class="p">,</span> <span class="s">&#39;@&#39;</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">]</span>
		<span class="c"># no return here, that&#39;s on purpose</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">tmp</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span> <span class="c"># anti-virus and indexers can keep the files open -_-</span>
	<span class="k">return</span> <span class="n">ret</span>

<span class="c">########## stupid evil command modification: concatenate the tokens /Fx, /doc, and /x: with the next token</span>

<div class="viewcode-block" id="exec_command_msvc"><a class="viewcode-back" href="../../../tools/msvc.html#waflib.Tools.msvc.exec_command_msvc">[docs]</a><span class="k">def</span> <span class="nf">exec_command_msvc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Change the command-line execution for msvc programs.</span>
<span class="sd">	Instead of quoting all the paths and keep using the shell, we can just join the options msvc is interested in</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CC_NAME&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;msvc&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
			<span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">carry</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
				<span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;/Fo&#39;</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;/doc&#39;</span> <span class="ow">or</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;:&#39;</span><span class="p">:</span>
					<span class="n">carry</span> <span class="o">=</span> <span class="n">a</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carry</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>
					<span class="n">carry</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">lst</span><span class="p">]</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;PATH&#39;</span><span class="p">]:</span>
			<span class="n">env</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
			<span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">PATH</span> <span class="o">=</span> <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;PATH&#39;</span><span class="p">]))</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span>

	<span class="n">bld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">bld</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cwd&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
			<span class="n">kw</span><span class="p">[</span><span class="s">&#39;cwd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">cwd</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="n">bld</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;cwd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">variant_dir</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_response_command</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;do_manifest&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_mf</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">ret</span>
</div>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="s">&#39;c cxx cprogram cxxprogram cshlib cxxshlib cstlib cxxstlib&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
	<span class="n">cls</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">cls</span><span class="p">:</span>
		<span class="n">cls</span><span class="o">.</span><span class="n">exec_command</span> <span class="o">=</span> <span class="n">exec_command_msvc</span>
		<span class="n">cls</span><span class="o">.</span><span class="n">exec_response_command</span> <span class="o">=</span> <span class="n">exec_response_command</span>
		<span class="n">cls</span><span class="o">.</span><span class="n">quote_response_command</span> <span class="o">=</span> <span class="n">quote_response_command</span>
		<span class="n">cls</span><span class="o">.</span><span class="n">exec_mf</span> <span class="o">=</span> <span class="n">exec_mf</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/waf-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Waf v1.6.8 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; <a href="../../../copyright.html">Copyright</a> 2010, Thomas Nagy.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19942299-1']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>